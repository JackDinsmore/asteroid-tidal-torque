\documentclass[fleqn,usenatbib]{mnras}

\usepackage[T1]{fontenc}

\DeclareRobustCommand{\VAN}[3]{#2}
\let\VANthebibliography\thebibliography
\def\thebibliography{\DeclareRobustCommand{\VAN}[3]{##3}\VANthebibliography}


%%%%% AUTHORS - PLACE YOUR OWN PACKAGES HERE %%%%%

% Only include extra packages if you really need them. Common packages are:
\usepackage{graphicx}	% Including figure files
\usepackage{amsmath}	% Advanced maths commands
\usepackage{amssymb}	% Extra maths symbols
\usepackage{xcolor}
\usepackage{tikz}
\usepackage{colortbl}
\usepackage{dsfont}
\usepackage{siunitx}
\usepackage{bm}
\usepackage{caption}
\usepackage{subcaption}
\usepackage{animate}
\usetikzlibrary{arrows.meta}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%%%%% AUTHORS - PLACE YOUR OWN COMMANDS HERE %%%%%
\newcommand{\jtd}[1]{ {\bf{\color{red} JTD: #1}} }
\newcommand{\unit}[1]{\bm{\hat{#1}}}

\newcommand{\parens}[1]{\left( #1 \right)}
\newcommand{\brackets}[1]{\left[ #1 \right]}
\newcommand{\quat}[1]{\widetilde{\bm{#1}}}

% Please keep new commands to a minimum, and use \newcommand not \def to avoid
% overwriting existing commands. Example:
%\newcommand{\pcm}{\,cm$^{-2}$}	% per cm-squared

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%%%%%%%%%%%%%%%%%%% TITLE PAGE %%%%%%%%%%%%%%%%%%%

\title[Flyby Constraints on Asteroids Interiors]{Constraining the Interiors of Asteroids Through Close Encounters}

% The list of authors, and the short list which is used in the headers.
% If you need two or more lines of authors, add an extra line using \newauthor
\author[Jack T. Dinsmore, Julien de Wit]{
Jack T. Dinsmore,$^{1}$\thanks{E-mail: jtd@stanford.edu}
Julien de Wit$^{2}$
\\
% List of institutions
$^{1}$Department of Physics, Massachusetts Institute of Technology\\
$^{2}$Department of Earth, Atmospheric, and Planetary Science, Massachusetts Institute of Technology
}

% These dates will be filled out by the publisher
\date{Accepted XXX. Received YYY; in original form ZZZ}

% Enter the current year, for the copyright statements etc.
\pubyear{2022}

% Don't change these lines
\begin{document}
\label{firstpage}
\pagerange{\pageref{firstpage}--\pageref{lastpage}}
\maketitle

% Abstract of the paper
\begin{abstract}
  Knowledge of the interior density distribution of an asteroid can reveal its composition and constrain its evolutionary history. However, most asteroid observational techniques are not sensitive to interior properties. We investigate the interior constraints accessible through monitoring variations in angular velocity during a close encounter. We derive the equations of motion for a rigid asteroid's orientation and angular velocity to arbitrary order and use them to generate synthetic angular velocity data for a representative asteroid on a close Earth encounter. Using Markov Chain Monte Carlo fits, we perform injection-retrieval tests on these synthetic data to gain insights into the extent to which interior properties can be constrained. We also perform a sensitivity analysis of such an inversion technique to asteroid parameters (e.g., moment of inertia and initial spin pole direction), observational set-up (e.g., measurement precision and cadence), and mapping models to convert constraints on the density moments to density distributions. We find that high precision in rotational period estimates (order of milliseconds to seconds) are necessary for each cadence, and that large asteroids ($> 100$ m radius) with low perigees ($<20$ Earth radii) are necessary to resolve second-order density moments.
\end{abstract}

% Select between one and six entries from the list of approved keywords.
% Don't make up new ones.
\begin{keywords}
  minor planets, asteroids: general -- methods: data analysis
\end{keywords}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%%%%%%%%%%%%%%%%% BODY OF PAPER %%%%%%%%%%%%%%%%%%

\section{Introduction}

Over the past twenty years, the increase in quantity and quality of sensitive all-sky surveys has prompted the discovery of numerous asteroids. Such advances have been made via ground-based surveys such as the Catalina Sky Survey \cite{larson1998catalina}, Pan-STARRS \cite{kaiser2002pan}, and the Lincoln Near-Earth Asteroid Research project (LINEAR) \cite{stokes2000lincoln}, as well as space-based instruments such as the Wide-field Infrared Survey Explorer (WISE) mission \cite{wright2010wide}. Many of these asteroids are relatively small, but some are kilometre-sized and a few are predicted to closely encounter Earth or other planets in the near future. More encounter candidates are likely to be discovered by new efforts such as the Large-aperture Synoptic Survey Telescope (LSST) \cite{tyson2002large}. Their encounters can then be monitored by global ground-based networks such as the Las Cumbres Observatory (LCO) \cite{brown2013cumbres}. Such ground-based monitoring is typically used to derive the rotation period of an asteroid and its surface properties (see e.g. \cite{10.1093/mnras/stab1252}).

Since the tidal torque acting on an asteroid during an encounter depends on the interior mass distribution, the careful monitoring of angular velocity variations during an encounter also presents a window into the interior properties of asteroids. The gravitational two-body system has
been studied in the context of tidal torque to different orders
and with several different methods \cite{paul88, SCHEERES2000106, ashenberg07, BOUE2009750, HouMar2017}. Further studies showed that the tidal torque, observed through angular velocity perturbations, is sensitive to asteroid interior density distribution \cite{Naidu_2015, Makarov2022ChaosOO, scheeres2004evolution}. However, density distribution features beyond the moment of inertia (MOI) ratios have not yet been extracted for any asteroid encounters. More research is needed to study in what cases these effects are observable, and what
factors generally inhibit observation of these new features. 

Angular velocity perturbations have been observed and
used to extract asteroid properties in several cases, including
for the 2013 encounter of (367943) Duende with Earth \cite{MOSKOVITZ2020113519, benson2020spin}, and asteroid
binaries (3905) Doppler and (617) Patroclus \cite{DESCAMPS2020113726, BERTHIER2020113990}. Orbital and physical properties, including MOI ratios have also been extracted for 99942 Apophis, which will closely encounter Earth in 2029 \cite{yu2014numerical, hirabayashi2021finite, valvano2022apophis, Lee2022Apophis}. It seems pivotal to augment previous work on the affect of tidal torque on Apophis' angular velocity \cite{souchay2014rotational, souchay2018changes} so that upcoming observations may constrain these properties and thus improve our predictions.

We address this community need by developing a methodology to translate (1) time series of asteroid angular velocity data into constraints on density moments and (2) constraints on density moments into constraints on an asteroid's density distribution. Other techniques, such as measurement of tidal distortion \cite{RICHARDSON199847}, impact or seismometry experiments \cite{RICHARDSON2005325}, or gradiometry \cite{carroll2018tidal}, may additionally constrain the density distribution. In section \ref{sec:methods}, we introduce the analytical and numerical fundamentals of this methodology. There, we describe a simulation used to integrate the equations of motion and produce synthetic data of angular velocity over time, followed by a Markov Chain Monte Carlo (MCMC) fit process which  extracts density moments from the fit data. We note that these equations fo motion for an asteroid equation are novel and designed to be computationally efficient and valid to arbitrary order. We then describe three methods to generate full density distributions from the density moments. In section \ref{sec:results}, we present the results of a series of injection-retrieval tests demonstrating the extent to which the properties of an asteroid chosen to generate synthetic spin data can be retrieved via our methodology. Finally, in section \ref{sec:discussion}, we assess the sensitivity of these constraints to various physical, observational, and methodological parameters to provide guidance for monitoring upcoming close encounters. We also test the density distribution extraction methods on several sample asteroids.





\section{Methods}
\label{sec:methods}

The only properties of an asteroid's density moments that affect tidal torque interactions are its ``density moments,'' defined here as
\begin{equation}
  K_{\ell m} = \frac{a_\mathcal{A}^{2-\ell}}{I_\mathcal{A}} \int_\mathcal{A} d^3 r \rho_\mathcal{A}(\bm r) R_{\ell m}(\bm r).
  \label{eqn:klm}
\end{equation}
These are complex, unitless quantities. $\rho_\mathcal{A}(\bm r)$ is the asteroid density distribution and $R_{\ell m}$ are the regular solid spherical harmonics (see appendix \ref{app:eom} for details). The integral is computed over the entire asteroid mass, denoted $\mathcal{A}$. $I_\mathcal{A}$ denotes a MOI scale defined as 
\begin{equation}
  I_\mathcal{A} = \int_\mathcal{A} d^3 r \rho_\mathcal{A}(\bm r) r^2
  \label{eqn:ia}
\end{equation}
while $a_\mathcal{A}$ is the length scale
\begin{equation}
  a_\mathcal{A}^2 = \frac{1}{V_\mathcal{A}} \int_\mathcal{A} d^3 r r^2
  \label{eqn:aa}
\end{equation}
where $V_\mathcal{A}$ is the asteroid volume. We call these MOI and length scales in part because they obey $I_\mathcal{A} = \mu_\mathcal{A} a_\mathcal{A}^2$ where $\mu_\mathcal{A}$ is the mass of the asteroid for uniform asteroids. Note that $a_\mathcal{A}$ is a function only of the surface of the asteroid, so that $a_\mathcal{A}$ is known if the surface is observed.

The tidal torque experienced by an asteroid is 
\begin{equation}
  \begin{split}
  \bm \tau = & G\frac{I_\mathcal{A}I_\mathcal{B}}{2 a_\mathcal{A}^2a_\mathcal{B}^2}\left[\sum_{\ell m} a_\mathcal{B}^\ell J_{\ell m} \sum_{\ell' m'}a_\mathcal{A}^{\ell'}S^*_{\ell+\ell', m + m'} (\bm D) (-1)^{\ell'}\right.\\
  \times & \left.\sum_{m''=-\ell'}^{\ell'} \sqrt{\frac{(\ell'-m'')!(\ell'+m'')!}{(\ell'-m')!(\ell'+m')!}}  \mathcal{D}^{\ell'}_{m'm''}(\alpha, \beta, \gamma)^* \right. \\
  \times & \Big((i\unit x - \unit y)(\ell'-m''+1)K_{\ell',m''-1} \\
  & +(i\unit x+\unit y)(\ell'+m''+1)K_{\ell',m''+1}+2im''\unit z K_{\ell'm''}\Big) \Bigg],
  \end{split}
  \label{eqn:tidal-torque}
\end{equation}
where $\bm D$ is the position of the asteroid; $\alpha$, $\beta$, and $\gamma$ are $z-y-z$ Euler angles expressing the orientation of the asteroid; $S_{\ell m}$ are the irregular solid spherical harmonics; and $\mu_\mathcal{B}$ and $a_\mathcal{B}$ are the mass and radius of the central body while $J_{\ell m}$ are the density moments of the central body, with the $a_\text{bulk}$ and $a_\text{surf}$ of equation \ref{eqn:klm} replaced by $a_\mathcal{B}$. Equation \ref{eqn:tidal-torque} is derived in appendix \ref{app:eom}, assuming a rigid asteroid and no distant third-body perturbations. 

Since it is the angular acceleration of the asteroid that is observable, rather than the torque applied, we also compute the MOI of the asteroid around the principal axes: 
\begin{equation}
  \begin{split}
    I_x &= \frac{2}{3} I_\mathcal{A} \parens{K_{20} - 6 K_{22} + 1}\\
    I_y &= \frac{2}{3} I_\mathcal{A} \parens{K_{20} + 6 K_{22} + 1}\\
    I_z &= \frac{2}{3} I_\mathcal{A} \parens{-2K_{20} + 1}.
  \end{split}
  \label{eqn:moi}
\end{equation}

The angular acceleration of the asteroid is proportional to $\bm \tau / I$ (equation \ref{eqn:omega-eom}), such that the $I_\mathcal{A}$ factor of equation \ref{eqn:tidal-torque} is canceled out. Thus, the observables do not depend explicitly on $I_\mathcal{A}$, nor on the asteroid mass.

Throughout the paper, we refer to the ``inertial frame'' (the frame in which the orbit is fixed) and the ``body-fixed frame'' (the frame in which the asteroid is fixed and in which $K_{\ell m}$, $I_\mathcal{A}$, and $a_\mathcal{A}$ are computed), which are also defined in appendix \ref{app:eom}.

\subsection{Simulation design}
\label{sec:sim}

We built a publicly accessible, custom simulation in C++ to produce time series of angular velocity data during a close encounter with a central body. This simulation requires as initial data (1) the orbital parameters of the asteroid $r_p$ (perigee distance) and $v_\infty$ (hyperbolic excess velocity); (2) the cadence of angular velocity observation $\Delta t$; (3) the central body moments $J_{\ell m}$, mass $\mu_\mathcal{B}$, and radius $a_\mathcal{B}$; (4) the initial asteroid angular velocity in the inertial frame $\bm \Omega_0$; (5) the asteroid length $a_\mathcal{A}$ and (6) the asteroid's density moments $K_{\ell m}$ and initial Euler angle $\gamma_0$. All parameters except (6) are assumed to be known to high accuracy. For example, $\bm \Omega_0$ could be extracted from pre-encounter light-curve data and $a_\text{surf}$ from a model for the asteroid's surface using radar.

We assume for simplicity that the asteroid is initially not tumbling, though this assumption can be relaxed. We assume a short-axis rotation mode such that energy of the asteroid's rotation is minimized. This sets $\beta = 0$ and we can further choose $\alpha = 0$. Only the Euler angle $\gamma_0$ is necessary to provide initial data for the simulation.

We begin our simulation at $D = 10 r_p$, with velocity predicted by Kepler's laws given by the orbital parameters. Since the leading order of the equations of motion is $\ell' = 2, \ell = 0$, this corresponds roughly to a torque of $10^{-3}$ times the maximum torque at perigee. Unless otherwise indicated, the simulation is terminated at $D=10 r_p$ as well.

With the simulation inputs specified, the equations of motion are integrated via the Runge-Kutta fourth order method, with a variable time step
\begin{equation}
  dt = dt_\text{min} + 10^{-3}(dt_\text{max} - dt_\text{min}) \brackets{\parens{\frac{D}{r_p}}^3 - 1}.
\end{equation}
The parameters $dt_\text{max}$ and $dt_\text{min}$ (20 and 10 seconds respectively) were chosen such that the numerical integration error was $\sim$100 times the floating point error, and that neighbouring values of $K_{\ell m}$ yielded significantly different spin pole data compared to floating point error. The data used to choose this $dt$ was obtained using the reference asteroid configuration, described in appendix \ref{app:reference-configs}.



\subsection{Uncertainty model}
\label{sec:uncertainty}

To add noise to data generated via the above simulation, we use the following uncertainty model. Each asteroid spin vector $\bm \Omega$ is assumed to be uncorrelated with other spin vectors, and we model uncertainty in the orientation and in the period as also uncorrelated. Consider a true spin vector $\bm \Omega^*$. For the sake of description, we work in coordinates in which $\bm \Omega^* \parallel \unit z$. Then, expressing the observed spin vector $\bm \Omega$ in spherical coordinates, we draw the polar angle from a normal distribution with standard deviation $\sigma_\theta$ centred on zero and the azimuthal angle from a uniform distribution. We also draw the ratio $\Omega/\Omega^*$ from a log-normal distribution centred on one, with width $\sigma_P / P$, where $P = 2\pi \Omega$ is the period of the asteroid. Explicitly, the probability density function (PDF) of $\rho$ is 
\begin{equation}
  P(\rho) = \frac{1}{\rho\sqrt{2\pi (\sigma_P / P)^2}} \exp\parens{-\frac{\ln^2\rho}{2(\sigma_P / P)^2}}.
\end{equation}
See figure \ref{fig:uncertainty-model} for an illustration of the uncertainty model. A log normal distribution is chosen such that $\rho > 0$, but since $\sigma_\rho \ll 1$ typically in our analysis, $P(\rho)$ is approximately Gaussian.

\begin{figure}
  \centering
  \begin{tikzpicture}
  \draw[-{Latex[length=3mm]}] (0, 0) -- (-4, 0) node[anchor=east] {$\unit X$};
  \draw[-{Latex[length=3mm]}] (0, 0) -- (1, -1.5) node[anchor=west] {$\unit Y$};
  \draw[-{Latex[length=3mm]}] (0, 0) -- (0, 4) node[anchor=south] {$\unit Z$};

  \draw[line width=0.5mm, -{Latex[length=3mm]}] (0, 0) -- (-3, 3) node[anchor=south] {$\bm \Omega^*$};
  \draw[dashed] (-3, -2) -- (-3, 3);
  \draw[dashed] (-3, -2) -- (0, 0);

  \draw[-{Latex[length=3mm]}] (0, 0) -- (-1.25, 3.35) node[anchor=south west] {$\bm \Omega$};
  \draw[rotate around={-50:(-3,3)}] (-3,3) ellipse (1.4 and 2);
  \draw (-3, 3) arc (110:93:6);
  \draw (-2, 3.5) node[anchor=center] {$\theta$};
  \draw (-0.5, 2.5) node[anchor=center] {$\rho \Omega^*$};

  \end{tikzpicture}
  \caption{Diagram in the inertial frame of the uncertainty model used to define the probability that the true spin vector $\bm \Omega^*$ should be observed as $\bm \Omega$. The parameter $\theta$ is drawn from a Gaussian with width $\sigma_\theta$, and $\rho$ is drawn from a log normal distribution with width $\sigma_\rho$.}
  \label{fig:uncertainty-model}
\end{figure}

The log likelihood resulting from this uncertainty model is (excluding additive constants)
\begin{equation}
  \begin{split}
  \ln \mathcal{L} = -\frac{1}{2}\sum_{i = 0}\Bigg[&\frac{\cos^{-1} (\bm \Omega_i^* \cdot \bm \Omega_i/(\Omega_i^* \Omega_i))^2}{\sigma_\theta^2}\\
  &+\frac{\ln \parens{\Omega_i /\Omega_i^*}^2}{(\sigma_P / P)^2} + 2\ln\frac{\Omega_i}{\Omega_i^*}\Bigg].
  \end{split}
  \label{eqn:log-likelihood}
\end{equation}
where $\Omega_i$ is the $i$th spin vector in the data set.

This model was chosen because it separates spin pole and period uncertainty. Therefore, if one is more precisely determined by measurement, $\sigma_\theta$ and $\sigma_P / P$ can be adjusted separately in accordance.





\subsection{Extracting density moments from spin data}
\label{sec:fit}
Given synthetic data, an Affine Invariant MCMC Ensemble sampler was used to generate PPDs from flat priors. We use the Python implementation \texttt{emcee} \cite{foreman2013emcee}. Our parameters were $\gamma_0$, $K_{20}$, $K_{22}$, and $K_{3m}$ (10 in total), and were bounded by $|\gamma_0| < \pi/4$, and bounds on $K_{2 m}$ given in equation \ref{eqn:parameter-bounds}. Note that $\gamma_0$ is degenerate with $\gamma_0 + \pi/2$ because both of these align the asteroid principal axes with the body-fixed axes. The other bounds were $|K_{3m}| < 1$. In general, spin data is most sensitive to $\gamma_0$ and $K_{2m}$, which we call the ``first-order parameters.'' We call $K_{3m}$ the ``second-order parameters.''

The MCMC was determined to converge when the fractional change in autocorrelation time (computed every 100 iterations) was one percent, and the number of iterations computed so far was more than 100 times the autocorrelation time. The MCMC fit also was set to terminate if more than $10^5$ iterations were run, but this only occurred for fits in which the data quality was low, leading to degeneracies between the second order parameters ($K_{3 m}$). This degeneracy could be removed by only fitting $K_{2m}$ instead. About $10^4$ iterations was often sufficient, which generally consumed about 7 hours of computation time on a super computer running 16 threads on 8 cores.

Before the MCMC was run, local minima in the likelihood were found via the Nelder-Mead algorithm implemented in \texttt{scipy} \cite{Gao2012}. Generally, only one local minimum existed, except when $K_{22}=0$ in which case rotational symmetry caused multiple values of $\gamma_0$ to be degenerate. Ensemble walkers were initialized near this local minimum, distributed by a Gaussian approximation of the likelihood, as determined via the Hessian of the likelihood at the minimum. Due to the high sensitivity of the angular velocity data to density moments, the minimization procedure sometimes failed to isolate the minimum likelihood. Therefore, a simpler simulation without the $K_{3m}$ terms of equation \ref{eqn:tidal-torque} was first used to minimize likelihood as a function of the first-order parameters $\gamma_0$ and $K_{2m}$, and then the full simulation was used to find the second-order parameters $K_{3m}$ with the first-order parameters fixed.

To further ensure convergence, we minimized with respect to data truncated after perigee at double the perigee distance. This cut-off was manually chosen. The minimum was then further refined by minimizing based on the full data, with the previous minimum as the initial estimate.


\subsection{Density distributon constraints}
\label{sec:density-distro}

The asteroid density distribution $\rho_\mathcal{A}(\bm r)$ is not uniquely constrained via tidal torque interactions because only the density moments $K_{\ell m}$ contribute to equation \ref{eqn:tidal-torque}. For example, since the mass of the asteroid is unconstrained, $\rho_\mathcal{A}(\bm r)$ cannot be determined on an absolute scale. However, by making sufficient assumptions about the density distribution, we can nevertheless extract fluctuations in $\rho_\mathcal{A}(\bm r)$ across the asteroid from $K_{\ell m}$. To best understand the potential density distribution of an asteroid, an ensemble of models with differing assumptions is desired, so that common traits across the models can be identified. To this end, we throughly outline two possible models and discuss two more in appendix \ref{app:other-models}.

We assume that the asteroid's surface is known in the inertial frame from radar data. Since the asteroid tumbles during the encounter, we also assume that the center of mass of the asteroid is extracted.  However, the density moments which are extracted from flyby data are known instead in the body-fixed frame.

We rotate the known surface of the asteroid to a new frame called the ``hybrid frame'' by translating such that the known center of mass is at the origin, then rotating such that $\Omega_0$ points in the $+\unit z_\text{hybrid}$ direction and $\unit Y$ points in the $\unit Y_\text{hybrid}$ direction. Since $\Omega_0$ is exact, the surface in this hybrid frame is known exactly. The hybrid frame differs from the body-fixed frame only by a rotation around $\unit z_\text{hybrid}$ of $\gamma_0$. Such rotations affect density moments via 
\begin{equation}
  K_{\ell m}^\mathrm{hybrid} = e^{-im\gamma_0}K_{\ell m}^\mathrm{body-fixed}.
  \label{eqn:body-fixed-to-hybrid}
\end{equation}
by equation \ref{eqn:ylm-rotation}. Thus, uncertainty on $K_{\ell m}^\mathrm{body-fixed}$ (obtained from the encounter data) can be translated to uncertainty in $K_{\ell m}^\mathrm{hybrid}$. Henceforth, we will operate only in the hybrid frame and suppress the label.

When the $K_{3m}$ are extracted, 15 moments are known (excluding $K_{00}$). Since the asteroid mass cannot be determiend by this analysis, it is convenient to additionally set the mass equal to its volume, so that the average density is one and thus the extracted densities can be interpreted as ratios of $\rho / \rho_\text{avg}$. Three more moments are redundant with the center of mass, such that only twelve finite elements are free. In cases where $\gamma_0$ is known very accurately such that the correction imposed by equation \ref{eqn:body-fixed-to-hybrid} is very small, it is numerically favourable not to impose this equation on $K_{2m}$. In this case, the three orientation constraints that set $K_{21}=\Im K_{22} = 0$ carry over to the hybrid frame so that there are nine degrees of freedom (DOF). Since $\gamma_0$ is precisely known for all cases studied in this paper, we will always study this case. We also place additional constraints that $0.25 < \rho < 3$ to ensure realistic densities.

To extract a density distribution, we use another MCMC given one of the two parametrizations of density distributions discussed below. The prior is set to be flat and nonzero for all configurations that obey the $0.25 < \rho < 3$ constraint. The likelihood used is set equal to the multivariate-Gaussian approximation of the posterior distribution for $K_{\ell m}$, extracted from flyby data. Otherwise, the MCMC parameters chosen were identical to those discussed in section \ref{sec:fit}. We also present two further models in appendix \ref{app:more-models} which are viable substitutes for the following two models but are not used in the main text.



\subsubsection{Finite element model}

Given values of $K_{\ell m}^\mathrm{body-fixed}$ and their uncertainties extracted from encounter data, there are many ways to extract a density distribution. Here, we outline a method termed the ``finite element'' model. We divide the asteroid into $N$ finite elements of uniform density and use the density $\rho_i$ of each as parameters. The four constraints imposed by the known mass and center of mass of the asteroid (seven with $K_{21}$ and $\Im K_{22}$ are also fixed) are used to constrain some of these $\rho_i$. The constrained densities are easily computed since the asteroid mass $\mu_\mathcal{A}$ and the product $I_\mathcal{A}K_{\ell m}$ are both linear functions of $\rho_i$. Because $K_{\ell m} = 0$ implies that $I_\mathcal{A}K_{\ell m} = 0$, computing the constrained densities is simply a matrix inversion.

The size and location of the elements must be chosen before extracting their densities. Best results generally require elements of equal size to be chosen. To remove the dependence on this choice, density distributions for many distinct element layouts can be extracted and the density of each point in the asteroid can be randomly sampled from any of these solutions to yield estimates for the mean density and uncertainty in density at each point.

The value of $N$ must be carefully chosen, since it embodies a balance between the precision and accuracy of the resulting distribution. If $N$ is set equal to the number of data points, an accurate solution is  guaranteed, but uncertainties are inflated. If $N$ is chosen lower, the choice of element layout might exclude a distribution that exactly matches $K_{\ell m}$, but uncertainties are diminished due to less redundancy in the model. An analysis of which value of $N$ is appropriate for our purposes is given in section \ref{sec:dof-scan}.

\subsubsection{Lumpy model}

A drawback of the finite element model is that the generated density distribution might not be representative of the asteroid if the elements are not optimally placed. We therefore describe an alternate model, which includes the positions of the elements as parameters at the cost of larger elements and therefore lower resolution. We call this model the ``lumpy'' model.

Suppose the asteroid is formed of $N$ constant-density, possibly overlapping ``lumps,'' enclosed within a constant-density substrate whose surface is visible to observers. The lumps and the substrate are described by the mass added to the substrate by a lump $\mu_i$, the position of its center of mass $\bm r_i$ (relative to the asteroid's center of mass), its density moments $K_{\ell m}^{(i)}$, and its length scale $a_i$. Here, $i$ denotes the index of the lump where the substrate is $i=0$.  We do not need to include $I_i$ as a free parameter because these lumps have constant density, so that $I_i = \mu_i a_i^2$. Furthermore, by requiring that a lump's density moments be computed relative to the center of mass of the lump, we have $K_{1m} = 0$.

The translation rules of spherical harmonics give that the asteroid properties in the hybrid frame are
\begin{equation}
  \begin{aligned}
    K_{\ell m} = &\brackets{\sum_{i=0}^N \frac{a_i^2 + r_i^2}
    {a_\mathcal{A}^2}\mu_i}^{-1} \\
    &\times \brackets{\sum_{i=0}^N \sum_{\ell' m'}\mu_i
    \frac{a_i^{\ell'}}{a_\mathcal{A}^\ell}
    R_{\ell - \ell', m - m'}(\bm r_i)K_{\ell' m'}^{(i)}} \\
  \end{aligned}
\end{equation}
where the sum limits are $0 \leq l' \leq l$ and $-\ell' \leq m' \leq \ell'$. We also have total mass and center of mass constraints:
\begin{equation}
  \mu_\mathcal{A} = \sum_{i=0}^N \mu_i,  \qquad 0 = \sum_{i=0}^N \mu_i \bm r_i.
\end{equation}
Additional constraints can be imposed on $K_{\ell m}^{(i)}$ if desired. For example, we can require that the lumps be ellipsoids, so that $K_{3 m}^{(i)} = 0$. Additional rotational symmetries also constrain $K$, with the most extreme case being that spherical lumps have $K_{\ell m} = 0$ for $\ell > 0$. However, $K_{00}=1$ is guaranteed by definition, meaning that each spherical lump has only five DOF ($a_i$, $\mu_i$, and $\bm r_i$). The substrate has one degree of freedom, since only $\mu_0$ is unknown. Thus, this lumpy model has $5N - 3$ total DOF. Again, the choice of $N$ affects the accuracy and uncertainty of the model results, which is discussed in section \ref{sec:density-compare}.



\section{Results}
\label{sec:results}

To demonstrate our interior-probing methodology, we provide a full density distribution retrieval applied to synthetic data for the asymmetric reference asteroid. We first introduce the retrieval capabilities regarding density moments, then we turn to the constraints that can be derived reliably on the density distribution. For both level of information retrieval, we find that the results are consistent with the properties used to generate the synthetic data.

\subsection{Density moments}
\label{sec:example-fit}
\begin{figure}
  \centering
  \includegraphics[width=\linewidth]{figs/example-residuals.pdf}
  \caption{Data, best-fitting results, and residuals for a fit to synthetic data simulated for an asymmetric reference asteroid. Uncertainty bands are also shown. The best fit results appear consistent with the data.}
  \label{fig:example-residuals}
\end{figure}

\begin{figure*}
  \centering
  \includegraphics[width=0.85\textwidth]{figs/example-corner.png}
  \caption{PPDs extracted from synthetic encounter data for the asymmetric reference asteroid. Samples from the MCMC fit are shown as individual points, and the contours enclose 1, 2, and 3$\sigma$ confidence regions. True values are shown as blue lines. PPDs are Gaussian and show no degeneracies.}
  \label{fig:example-corner}
\end{figure*}

Figure \ref{fig:example-residuals} shows our synthetic spin data. The best-fitting model is overlaid in the top panel and residuals are shown the bottom panel. Uncertainties are plotted on the residuals corresponding to the square root of the diagonal entries of the covariance matrix (correlations not included). The fit results are clearly consistent with the data. This figure is also instructing in revealing which points in the data set are most informative. The at-perigee data is irregular and reveals information about the density moments, and the post-perigee data shows torque-free tumbling behaviour which constrains $K_{2m}$ via the moment of inertia ratios, and also indirectly sheds light on the at-perigee data by constraining the rotational velocity the asteroid must have had when leaving the perigee.

Figure \ref{fig:example-corner} shows a corner plot of the PPDs of the ten parameters (namely $\gamma_0$ and $K_{\ell m}$ for $\ell \leq 3$), marginalized to functions of one (histograms) or two (contours) variables. The true parameters are shown as lines. Note that the true parameters usually lie within 1 or 2$\sigma$ of the $\Delta K_{\ell m} = 0$, where $\Delta K_{\ell m}$ is the difference between the posterior $K_{\ell m}$ and the true $K_{\ell m}$. The PPDs are generally Gaussian and sometimes show correlation between parameters, but no continuous degeneracy occurs. We performed 48 independent minimizations of the likelihood before the MCMC fit began, each with an initial point chosen randomly in the parameter space. All converged to the same minimum, demonstrating that the model lacks discrete degeneracy as well.



\subsection{Density distribution}
\label{sec:asym-density}

Density moments of the kind described above were extracted for the asymmetric and symmetric reference asteroids. The finite element model was then used to extract density distributions from these moments, and propagate uncertainties. Five DOF were used rather than the maximum possible number of nine, and 20 different finite element layouts were used to generate sample density distributions to avoid dependence on the manually-chosen layout. The resulting density distributions and uncertainties are displayed in figure \ref{fig:uniform}.
\begin{figure*}
  \includegraphics[width=0.24\linewidth]{figs/asym-fe-d}\hfill
  \includegraphics[width=0.24\linewidth]{figs/asym-fe-s}\hfill
  \includegraphics[width=0.24\linewidth]{figs/asym-fe-u}\hfill
  \includegraphics[width=0.24\linewidth]{figs/asym-fe-r}

  \includegraphics[width=0.24\linewidth]{figs/asym-l-d}\hfill
  \includegraphics[width=0.24\linewidth]{figs/asym-l-s}\hfill
  \includegraphics[width=0.24\linewidth]{figs/asym-l-u}\hfill
  \includegraphics[width=0.24\linewidth]{figs/asym-l-r}

  \includegraphics[width=0.24\linewidth]{figs/sym-fe-d}\hfill
  \includegraphics[width=0.24\linewidth]{figs/sym-fe-s}\hfill
  \includegraphics[width=0.24\linewidth]{figs/sym-fe-u}\hfill
  \includegraphics[width=0.24\linewidth]{figs/sym-fe-r}

  \includegraphics[width=0.24\linewidth]{figs/sym-l-d}\hfill
  \includegraphics[width=0.24\linewidth]{figs/sym-l-s}\hfill
  \includegraphics[width=0.24\linewidth]{figs/sym-l-u}\hfill
  \includegraphics[width=0.24\linewidth]{figs/sym-l-r}

  \caption{Cross-sectional slices of the density distributions extracted via the finite element model for the asymmetric (\textit{first and thrid row}) and symmetric (\textit{second and fourth rows}) reference asteroids. The finite element model (\textit{top two rows}) and the lumpy model (\textit{bottom two rows}) are employed. From left to right, the densities, deviations from the true density, uncertainties, and significance of the deviations are plotted. These figures are available in animated form in appendix figure \ref{fig:animated-uniform}.Extracted densities are generally within 10\% of the truth.}
  \label{fig:den-uniform}
\end{figure*}

The figure demonstrates that the finite element model successfully extracts density distributions consistent with the extracted density moments, as shown by the $\chi^2$ value per degree of freedom, $\chi^2_r$, depicted in the figure. These express the agreement of the density moments of the shown distributions with the posterior distributions for the density moments, produced by the MCMC described in section \ref{sec:fit}. $\chi^2_r = 0$ indicates that the moments of the shown distributions are exactly equal to the means of the moment posterior extracted by the MCMC. The accuracy of this model is robust for additional shapes, including non-ellipsoidal shapes.

Furthermore, the finite element density distributions are consistent with uniform, which is the true density distribution of the asteroid. For the reference asteroid observational set-up, the uncertainty on observations is such that the density distribution is generally within 10\% of the true density (second column) while the density uncertainty is generally less than 40-50\% of the density value at any point in the asteroid (third column). The dependence of this constraint on the observational set-up is discussed in section \ref{sec:fit-uncertainty}. In no place is the significance of these deviations from the true distribution greater than $0.3 \sigma$ (last column).

The lumpy model also yields distributions which are consistent with the extracted moments and consistent with uniform. These distributions have much lower uncertainty than the finite element distributions (maximum uncertainty on the order of \jtd{number}) due to its few degrees of freedom. With only one lump, the location of the known center of mass requires that the lump lie at the centroid of the asteroid center with mass close to zero and unconstrained radius. Hence, the uncertainty of regions far from the asteroid is typically very small, while regions close to the center are more apt to be contained inside a lump. In order for the lumpy model to converge given the unconstrained lump radius, we use the mass-weighted $\mu_i a_i \rightarrow 0$ as a model parameter rather than the lump length $a_i$.

We also explore model behaviour in non-uniform density asteroids. We employ an asteroid of the same shape as the asymmetric asteroid, and in the same flyby scenario, but we place a solid core of radius $\SI{500}{\meter}$ and density three times the surrounding density at the center of the asteroid. This changes the asteroid density moments. New density moments are extracted via the process described in section \ref{sec:fit} and the finite-element and lumpy models are used to extract density distributions shown in figure \ref{fig:center-core}.
\begin{figure*}
  \includegraphics[width=0.24\linewidth]{figs/sph-3-fe-d}\hfill
  \includegraphics[width=0.24\linewidth]{figs/sph-3-fe-s}\hfill
  \includegraphics[width=0.24\linewidth]{figs/sph-3-fe-u}\hfill
  \includegraphics[width=0.24\linewidth]{figs/sph-3-fe-r}

  \includegraphics[width=0.24\linewidth]{figs/sph-3-l-d}\hfill
  \includegraphics[width=0.24\linewidth]{figs/sph-3-l-s}\hfill
  \includegraphics[width=0.24\linewidth]{figs/sph-3-l-u}\hfill
  \includegraphics[width=0.24\linewidth]{figs/sph-3-l-r}

  \caption{Cross-sectional slices of the density distributions extracted via the finite-element (\textit{top}) and lumpy (\textit{bottom}) models for an asteroid with a centred core. From left to right, the densities, deviations from the true density, uncertainties, and significance of the deviations are plotted. These figures are available in animated form in appendix figure \ref{fig:animated-den-sph}. The core is successfully extracted in all cases.}
  \label{fig:den-sph}
\end{figure*}

Once again, figure \ref{fig:center-core} shows that the model results are successful in that they reproduce the extracted density moments ($\chi^2_r$ is low). However, the density distributions extracted by the finite model match the true distributions less well. The deviation the true density extends to as much as 35\% in some locations, leading to a maximum significance of $0.86\sigma$. The distributions are consistent with the true distribution, but the finite element model has distributed the core into the rest of the asteroid so that the peak density is lowered.

However, the lumpy model is designed to detect discrete changes in density distribution, and identifies the boundary of the core very accurately. Deviations from the truth are less than 0.2\%, with uncertainties about 10\% of the local density at maximum and usually much lower. THe significance of the deviations is around 20\%, as it was in figure \ref{fig:uniform} where the extracted distribution again matched the truth. The low uncertainty is caused by the small number of degrees of freedom (2) of the lumpy model. A consequence is that if the core had been non-spherical, the lumpy model would be inaccurate, with significant deviations from the truth. Therefore, neither model is more correct in the general case, but each can be used to explore different scenarios.




\section{Discussion}
\label{sec:discussion}

% In this section, we discuss the sensitivity of our results to the properties of the asteroid encounter system. We start with the encounter properties that are required to adequately constrain the asteroid's density moments and distribution, and further discuss the properties of Jupiter encounters compared to Earth encounters. Finally, we discuss in greater detail which features of an asteroid density distribution can be extracted by our models and which cannot be.

\subsection{Dependence of uncertainty on encounter properties}
\label{sec:fit-uncertainty}


The question of which encounters are most suited to this methodology is of great interest, as is the question of how observational campaigns can be designed to best take advantage of an asteroid to maximize the success of this methodology. We investigate a mix of encounter parameters, from observational parameters (the data uncertainty, the cadence of observations, and gaps in data coverage) and physical asteroid properties (the encounter's orbital properties, the asteroid's true shape, and its initial rotational velocity), and discuss their effect on the uncertainty of this methodology's results.

We study both the uncertainties on the density moments and uncertainty on density distribution. Moment uncertainty $\sigma (K_{\ell m})$ is defined as the range of $K_{\ell m}$ values that contains 68.27\% of the marginal PPD for each $\ell$ and $m$. Since there is no degeneracy between moments and the actual encounter data, this uncertainty is well-defined. However, its physical relevance is not obvious. The density distribution uncertainty $\sigma_\rho / \rho$ is defined as a map of uncertainty over the asteroid, made by taking the standard deviation of density at each point over 5000 maps of asteroid density, each made using a different sample of the output of the density distribution MCMC described in section \ref{sec:density-distro}. The median uncertainty over this map, divided by the local density, is taken to represent the density distribution uncertainty. This measure of uncertainty is more physically relevant than moment uncertainty, but it is strongly dependent by choices of the density distribution model, degrees of freedom, prior constraints, and other effects unrelated to the encounter properties. We therefore investigate both the moment uncertainty and the density distribution uncertainty. 

\begin{table}
  \centering
  \begin{tabular}{lll} \hline
    Encounter property & Weak &Strong \\ \hline
    Perigee ($r_p$, Earth radii) & $<$6.0 & $<$18\\
    Excess velocity ($v_\infty$) & - & - \\
    Asteroid length ($a_\mathcal{A}$, m) & $>$15 & - \\
    Period ($P_\omega$, hr) & $>$7.6 & - \\ \hline
    Spin period uncertainty ($\sigma_P$, ms) & $<$12 & $<$270\\
    Spin pole uncertainty ($\sigma_\theta$, $^\circ$) & $<$1.9 & $<$35 \\
    Cadence ($\Delta t$, min) & $<$15 & - \\
    Data gap ($T_\text{gap}$, hr) & - & - \\ 
    \hline
  \end{tabular}
  \caption{The weak and strong thresholds on physical / observational properties (\textit{top} / \textit{bottom}) consistent with useable density distribution uncertainty. Perigee and observational uncertainty are the most constraining properties, followed by rotational period, asteroid length, and observational cadence.}
  \label{tab:threshold-summary}
\end{table}

\begin{figure*}
  \centering
  \includegraphics[width=0.5\linewidth]{figs/spin-unc.pdf}
  \caption{Median ratio of density uncertainty to density computed over the reference asteroid density distribution via the lumpy model as a function of initial spin pole direction. The benchmark uncertainty thresholds (\textit{red lines}) are shown, as is the reference spin pole direction (\textit{\jtd{What symbol?}}). \jtd{Summary}}
  \label{fig:spin-uncertainty}
\end{figure*}

\begin{figure*}
  \centering
  \includegraphics[width=\linewidth]{figs/unc-scan.pdf}
  \caption{Median ratio of density uncertainty to density computed over the reference asteroid density distribution as a function of physical / observational encounter properties (\textit{top / bottom}). Density distributions from both the lumpy and finite element models are used. The benchmark uncertainty thresholds (\textit{red lines}) are shown and the properties that exceed these thresholds are shaded. Te vertical black dotted lines are the property values of the reference asteroid. The figures illustrate the marked difference in density distributions that results from using different models.}
  \label{fig:net-uncertainty}
\end{figure*}

Table \ref{tab:threshold-summary} displays the encounter properties which beyond which the density distribution uncertainty rises above two sample values we term the ``weak'' and ``strong'' thresholds. These values are $\sigma_\rho / \rho = 10^{-4}$ (weak) and $10^{-3}$ (strong), for density distributions extracted via the lumpy model. These thresholds are manually chosen, and adjustments to them or to the lumpy model will affect the data of table \ref{tab:threshold-summary}. Figure \ref{fig:spin-uncertainty} depicts the same $\sigma_\rho / \rho$ as a function of initial spin pole direction, while figure \ref{fig:net-uncertainty} depicts $\sigma_\rho / \rho$ as a function of the encounter properties. Both highlight the threshold values of table \ref{tab:threshold-summary} with red lines. Bands contain 68\% (light) and 95\% (dark) of the density uncertainty over the asteroid are shown for figure \ref{fig:net-uncertainty}.

Table \ref{tab:threshold-summary} reveals that the most limiting physical properties of the asteroid are its perigee and period. Excess velocity does not greatly affect the uncertainty of the density distribution, and asteroid length is only effective for $a_\mathcal{A} \sim 15$ m. By contrast, the radius of asteroid 99942 Apophis is 
$\sim 300$ m and Apophis will encounter Earth in 2029. Apophis's perigee of 5--6 Earth radii also obeys the weak and strong constraints. In addition to the period constraint shown in this table, figure \ref{fig:spin-uncertainty} also shows a threshold on spin pole direction. \jtd{Describe}.

Table \ref{tab:threshold-summary} also demonstrates the strong affect of properties of the observational campaign on the final density uncertainty. Most vital are the uncertainty on the instantaneous asteroid rotational period $\sigma_P / P$ and its direction $\sigma_\theta$, which require precision on the order of tens to hundreds of milliseconds and degrees every cadence, respectively. This could be accomplished by multiple, precise angular velocity measurements from multiple telescopes, or by increasing the time between observations to maximize the change in period between observations. Increasing the data set size to include more post-flyby tumbling data would also relieve the burden on each data point for uncertainty to be so low. On the other hand, the cadence of observations $\Delta t$ and the presence of gaps in the data $T_\text{gap}$ do not affect results as strongly. Observations can be as much as 15 minutes apart to obey the weak threshold, with no constraint required to meet the strong threshold in our data set (which contains $\Delta t < 1$ hr). Likewise, there is no constraint on our data set of $T_\text{gap} < 3$ hr. This gap was simulated to occur in one contiguous unit centred on the encounter perigee, where torque is highest. If the gap occurred elsewhere in the data set or was subdivided into multiple gaps, it would likely affect density uncertainty even less. All of these thresholds are liable to change if the encounter properties are adjusted, since they are all interdependent.

Figure \ref{fig:net-uncertainty} reveals that the thresholds presented in table \ref{tab:threshold-summary} are particularly sharp (a steep slope of $\sigma_\rho / \rho$) for the encounter perigee $r_p$and observational precision $\sigma_P$ and $\sigma_\theta$. These thresholds are therefore less likely to change if the asteroid properties are altered, whereas the thresholds on period $P_\omega$, length $a_\mathcal{A}$, and cadence $\Delta t$ are much more volatile. The figure also displays the stark difference between density uncertainty as computed by the lumpy model and the finite element model. This is partially due to different choices in the number of DOF (5 for the finite element model and 2 for the lumpy model). The model assumptions also affect this uncertainty; the lumpy model must place the asteroid lump at the center of the asteroid since placing it elsewhere would move the asteroid's center of mass away from its observed position. Therefore, uncertainty on the edge of the asteroid where the lump is unlikely to be located, is very low for the lumpy model. The same reasoning does not apply to the finite element model, which has no bias towards the asteroid center. This model-dependence of $\sigma_\rho / \rho$ is another reason to take the thresholds of table \ref{tab:threshold-summary} as estimates rather than strict limits on encounter properties.

\begin{figure*}
  \centering
  \includegraphics[angle=90, origin=c, width=\linewidth]{figs/scan-all1.pdf}
  \caption{1 and 2$\sigma$ confidence intervals for the first-order parameter PPDs (\textit{top}) and second-order parameters (\textit{bottom}) as a function of (left to right) perigee, excess velocity, spin pole uncertainty, and period uncertainty. The vertical dashed line indicates the reference asteroid values. The red vertical lines indicate when $\sigma(K_{3m}) =0.01$.}
  \label{fig:scan-perigee}
  \label{fig:scan-vex}
  \label{fig:scan-am}
  \label{fig:scan-period}
  \label{fig:scan-physical}
\end{figure*}

\begin{figure*}
  \centering
  \includegraphics[angle=90, origin=c, width=\linewidth]{figs/scan-all2.pdf}
  \caption{1 and 2$\sigma$ confidence intervals for the first-order parameter PPDs (\textit{top}) and second-order parameters (\textit{bottom}) as a function of (left to right) asteroid length, observational cadence, data gap at perigee, and rotational period. The vertical dashed line indicates the reference asteroid values. The red vertical lines indicate when $\sigma(K_{3m}) =0.01$.}
    \label{fig:scan-rho}
    \label{fig:scan-theta}
    \label{fig:scan-cadence}
    \label{fig:observation-gap}
    \label{fig:scan-observational}
\end{figure*}

\begin{figure*}
  \includegraphics[width=0.3\textwidth]{figs/probe-space-theta-1-sigma.pdf}\hfill
  \includegraphics[width=0.3\textwidth]{figs/probe-space-theta-2-sigma.pdf}\hfill
  \includegraphics[width=0.3\textwidth]{figs/probe-space-theta-3-sigma.pdf}

  \includegraphics[width=0.3\textwidth]{figs/probe-space-ab-1-sigma.pdf}\hfill
  \includegraphics[width=0.3\textwidth]{figs/probe-space-ab-a-sigma.pdf}\hfill
  \includegraphics[width=0.3\textwidth]{figs/probe-space-ab-b-sigma.pdf}

  \caption{1$\sigma$ posterior uncertainty for first-order parameters $\gamma_0$, $K_{22}$, and $K_{20}$ (\textit{top row}) and $\gamma_0$, $a/c$, and $b/c$ (\textit{bottom row}). Also shown as black points are the reference asteroid shapes: symmetric (red circle) and asymmetric (black triangle). Symmetric asteroids ($K_{22}=0$ or $a/c=b/c$) show increased posterior uncertainty, but otherwise posterior uncertainty is roughly constant.}
  \label{fig:scan-space-sigma}
\end{figure*}

To address the dependence of $\sigma_\rho / \rho$ on the choice of model, we investigate moment uncertainty as well. Figures \ref{scan-physical} and \ref{scan-observational} display moment uncertainty $\sigma(K_{\ell m})$ on physical and observational encounter properties respectively. The thresholds of table \ref{tab:threshold-summary} are depicted as red lines. Also shown is moment uncertainty as a function of $K_{2m}$ in figure \ref{fig:scan-space-sigma}.

Figure \ref{scan-physical} reveals that $\sigma_\rho / \rho$ is more sensitive to $\sigma (K_{2m})$ than to $K_{3m}$. For instance, $\sigma(K_{2m})$ is constant as $a_\mathcal{A}$ is varied despite a dramatic increase in $\sigma(K_{3m})$ for low $a_\mathcal{A}$. The resulting $\sigma_\rho / \rho$ is mostly constant. However, the roles are reversed for $P_\omega$, where $\sigma(K_{3m})$ (except for $m=0$) are mostly constant, and here $\sigma_\rho /\rho$ follows the trend of $\sigma(K_{2m})$ and increases for low rotational period. This fact has several consequences. First of all, if more post-flyby tumbling data is collected, this will place stronger constraints on $K_{2m}$ and not $K_{3m}$. If so much data is available that $K_{2m}$ have essentially no uncertainty, then uncertainty on $K_{3m}$ will be dominant and the most constraining parameters will change. Rotational period $P_\omega$ will cease to be a vital parameter but asteroid length $a_\mathcal{A}$ will be because $\sigma(K_{3m})$ are much more dependent on $a_\mathcal{A}$ than $P_\omega$.

Figure \ref{fig:scan-physical} also demonstrates exponentially increasing $\sigma(K_{\ell m})$ as a function of perigee $r_p$, indicating that the constraint on $r_p$ noted in table \ref{tab:threshold-summary} is not entirely a feature of the density model. (Figure \ref{fig:net-uncertainty} also indicated this, since $\sigma_\rho / \rho$ falls for low perigee in both the lumpy and the finite element model). Dependence of moment uncertainty on data precision $\sigma_P$ and $\sigma_\theta$ is similarly exponential as shown by figure \ref{fig:scan-observational}. However, moment uncertainty on cadence $\Delta t$ and gaps in data $T_\text{gap}$ are less exponential. These tend to increase in uncertainty at some characteristic time scale of $\Delta t \sim 15 -40$ min for cadence and $1-2$ hr for $T_\text{gap}$. As long as $\Delta t$ and $T_\text{gap}$ are below these time scales, uncertainty is not strongly dependent on them.

Finally, figure \ref{fig:scan-space-sigma} depicts moment uncertainty $\sigma(K_{2m})$ as a function of $K_{2m}$ and $\gamma_0$. $K_{2m}$ can be interpreted as moment inertia ratios or the dimensions of the uniform-density ellipsoid with the same $K_{\ell m}$. Therefore, moment uncertainty is depicted both as a function of $K_{2m}$ and these ratios $a/c$ and $b/c$. The figure shows a dramatic increase in moment uncertainty for $K_{22} = 0$, which corresponds to $a=b$, or a rotationally symmetric ellipsoid. This uncertainty is caused by degeneracy in the model; if the asteroid is rotationally symmetric, then two principal axes can lie anywhere in the $xy$-plane, so that the definition of $\gamma_0$ becomes meaningless. $\gamma_0$ is therefore poorly constrained as $K_{22} \rightarrow 0$. Figure \ref{fig:uniform} revealed that density distributions can still be extracted for symmetric asteroids, but to reduce uncertainty, the moments must be re-parametrized to remove this degeneracy if this methodology is to be run on nearly symmetric asteroids. Beyond this dependence on $K_{2m}$, almost no moment uncertainty variation is visible, indicating that this methodology will give similar results given many asteroid shapes distinct from the reference asteroid.


\subsection{Comparison of Jupiter and Earth encounters}
\label{sec:jupiter-earth}

If sufficiently accurate spin pole data can be detected for non-Earth encounters, it may be possible to extract density moments for encounters with larger planets. In this section, we run our reference asteroid through a Jupiter encounter to analyze the differences in uncertainty.

The physical parameters of the asteroid body are kept the same as the Earth encounter case (listed in appendix \ref{app:reference-configs}), as are the observational uncertainty and cadence. The orbit is adjusted for the Jupiter case by setting a perijove distance of $r_p=5$ Jupiter radii (compared to perigee radius $r_p=5$ Earth radii for the Earth encounter). The excess velocity does not strongly affect $\sigma(K_{\ell m})$ as shown in section \ref{sec:scan-orbit}, so we keep it at the reference value.
The ratio between the posterior uncertainties in the Jupiter and the Earth encounters are shown in table \ref{tab:jupiter-uncertainty}. In all cases, the Jupiter posteriors are more uncertain than Earth posteriors.

\begin{table}
  \centering
  \begin{tabular}{c|cc}
    \hline 
    $K_{\ell m}$ & $\sigma(K_{\ell m})_\text{Jupiter}/\sigma(K_{\ell m})_\text{Earth}$\\ \hline 
    $\gamma_0$ & 1.6 \\
    $K_{22}$ & 2.3 \\
    $K_{20}$ & 11 \\
    $\Re K_{33}$ & 18 \\
    $\Im K_{33}$ & 18 \\
    $\Re K_{32}$ & 18 \\
    $\Im K_{32}$ & 18 \\
    $\Re K_{31}$ & 25 \\
    $\Im K_{31}$ & 10 \\
    $K_{30}$ & 53 \\ \hline
  \end{tabular}
  \caption{Ratio of posterior uncertainty for all density moments $K_{\ell m}$ between an Earth encounter and a Jupiter encounter with identical properties except for an increased perigee. Observational uncertainty and cadence are assumed to be equivalent for the Jupiter and Earth encounters. Without taking the frequencies of close encounters into account, massive planets such as Jupiter yield less precise density moment estimates.}
  \label{tab:jupiter-uncertainty}
\end{table}

These uncertainty ratios can be understood as follows. The leading order of tidal torque is proportional to $\mu_\mathcal{A} / D^3$. If $D/a_\mathcal{B}$ (the ratio of the encounter distance to the central body radius) is roughly constant (as in this case, where $r_p/a_\mathcal{B}=5$), then $\mu_\mathcal{A} / D^3 \propto \rho_\mathcal{B}$ where $\rho_\mathcal{B}$ is the density of the central body. Therefore, little advantage is to be gained by looking for encounters of a massive planet in this sense. Since Jupiter is less dense than Earth, we expect that uncertainty in the first-order parameters $\gamma_0$ and $K_{2m}$ would be slightly worse than in the case of Earth, which is seen in table \ref{tab:jupiter-uncertainty}.

The second-order terms are damped by an additional factor of $a_\mathcal{A}/D$, which decreases if a massive central body is used. Since Jupiter is about 10 times larger in radius than Earth, we expect that the $K_{3m}$ terms are about ten times more uncertain than the $K_{2m}$ components, which is the case.

The $K_{\ell 0}$ components differ in that the posterior uncertainty increase for a Jupiter encounter over an Earth encounter is about five times greater for $K_{\ell 0}$ than other moments of the same $\ell$. In fact, $K_{30}$ essentially fills the prior. In section \ref{sec:scan-spin}, we noted that $K_{\ell 0}$ is particularly uncertain when the asteroid does not tumble after the perigee. In this case, the Jupiter encounter resulted in less tumbling than the Earth encounter, so the larger increase in uncertainty in $K_{\ell 0}$ shown in table \ref{tab:jupiter-uncertainty} is expected.

There are additional effects of central body mass which are not captured in this analysis. For example, encounters with massive planets are more plentiful, so that observation for a fixed period of time will lead to a larger number of observed encounters conducive to low-uncertainty moment extraction (large $a_\mathcal{A}$, small $r_p$, etc.). The distribution of $r_p$ in this encounter sample will also change; the ratio of the orbit impact parameter (the distance between the orbit asymptotes and the central body) to perijove distance is 
\begin{equation}
  \frac{b}{r_p} = \sqrt{1+2\frac{G\mu_\mathcal{B}}{r_p v_\infty^2}}.
\end{equation}
It was mentioned above that the observable perigee distance $r_p$ increases with $a_\mathcal{B} \sim \mu_\mathcal{B}^{1/3}$, so that $\frac{b}{r_p}$ is larger for more massive planets and therefore the same impact parameter leads to lower perijove. Other effects, such as a change in the physical properties of the encountering asteroids or decreased observational uncertainty due to the distance between Jupiter and Earth-based telescopes, may also affect the fit uncertainties. Which of these contradicting effects dominates is not immediately clear, and depends on the asteroid population near Jupiter and the observation method.



\subsection{Finite element model DOF}
\label{sec:dof-scan}
The number of elements $N$ used for the finite element model can be freely chosen. As discussed in section \ref{sec:finite-element}, seven of these are fixed by various constraints on the asteroid density distribution. There are 16 density moments with $\ell \leq 3$, so $N=16$ with nine DOF is the largest number of parameters the model can support. However, maximizing the DOF adds model-induced uncertainty to our results. This uncertainty can be reduced by reducing $N$, but with $N < 16$, a solution perfectly matching the extracted moments is not guaranteed. There is therefore a trade-off between the average density uncertainty $\sigma_\rho$ and the accuracy, which can be represented as the deviation of the density distribution from the true distribution $\Delta \rho$.

We investigate this trade-off by extracting five density distributions with five different finite-element layouts from moments extracted from synthetic data of the asymmetric reference asteroid. For each point in the asteroid, 1000 samples are drawn from each of the five density distributions. We use the standard deviation of the 5000 samples as the uncertainty $\sigma_\rho$ at that point, and the mean of the samples as the density $\rho$. Modelling the asteroid as having a uniform true density, we compute the deviation of the density from the truth $\Delta \rho$ over the asteroid. We do this for 9 (maximal), 7, 5, 3, and 2 DOF. Additionally, we vary the precision $\sigma_P$ of the data set used to extract the density moments, and plot $\sigma_\rho$ and $\Delta \rho$ as a function of $\sigma_P$. Figure \ref{fig:dof-scan} displays the distribution of $\sigma_\rho$, $\Delta \rho$, and the significance of the deviations from the truth ($\Delta \rho / \sigma_\rho$) over the asteroid.

\begin{figure}
  \includegraphics[width=\linewidth]{figs/dof-scan.pdf}
  \caption{The average uncertainty $\sigma_\rho$ and deviation from the truth $\Delta \rho$ of density distributions extracted by the finite element model with varying degrees of freedom. 5 DOF appears to optimize the trade-off between the model-induced uncertainty caused by too many DOF and the inaccuracy caused by too few.}
  \label{fig:dof-scan}
\end{figure}

The figure demonstrates the expected behaviour that few degrees of freedom results in low uncertainty but large $\Delta \rho / \sigma$, wile many degrees of freedom is more accurate but also more uncertain. The trend of uncertainty, deviation, and significance as a function of $\sigma_P$ is also discontinuous for few DOF, because in these cases the properties of the output distribution are strongly dependent on the initial choice of uncertainty of the initial choice of grids, and more than five grids are necessary to remove that dependence. This discontinuity is most noticeable for 3 and 2 DOFs, which also produce deviations from the true density distribution of the highest significance. We use 5 DOFs throughout this paper, produce the most precise results while still accurately reproducing the asteroid density distribution. 5 DOFs corresponds to $N=12$ finite elements.

The top panel of \ref{fig:dof-scan} also demonstrates that $\sigma_\rho$ reaches a plateau for large $\sigma_P$. In that regime, the prior constraints that the density of the asteroid take on physically meaningful values are more constraining than the actual data, leading to less dependence on the data quality. This is a further example of how the extracted asteroid density distribution is strongly dependent on the choice of model, and one of the reasons why we display the uncertainties of density moments in section \ref{sec:fit-uncertainty} rather than density distribution uncertainty. This moment uncertainty is not prone to the same model-dependent plateau.


\subsection{Comparisons between density distribution models}
\label{sec:density-compare}

In section \ref{sec:asym-density}, we displayed uniform and non-uniform density distributions extracted via the finite element and single-lump lumpy model. Here we highlight the success of the model in two other scenarios.

\begin{figure*}
  \includegraphics[width=0.24\linewidth]{figs/move-fe-d}\hfill
  \includegraphics[width=0.24\linewidth]{figs/move-fe-s}\hfill
  \includegraphics[width=0.24\linewidth]{figs/move-fe-u}\hfill
  \includegraphics[width=0.24\linewidth]{figs/move-fe-r}

  \includegraphics[width=0.24\linewidth]{figs/move-l-d}\hfill
  \includegraphics[width=0.24\linewidth]{figs/move-l-s}\hfill
  \includegraphics[width=0.24\linewidth]{figs/move-l-u}\hfill
  \includegraphics[width=0.24\linewidth]{figs/move-l-r}

  \caption{Cross-sectional slices of the density distributions extracted via the finite-element (\textit{top}) and lumpy (\textit{bottom}) models for an asteroid with an off-center core. From left to right, the densities, deviations from the true density, uncertainties, and significance of the deviations are plotted. These figures are available in animated form in appendix figure \ref{fig:animated-move}. The core is successfully extracted in all cases.}
  \label{fig:den-move}
\end{figure*}

Figure \ref{fig:den-move} shows density distributions extracted via the finite element model and the lumpy model for an off-center core. Results are similar to the centred core shown in \ref{fig:den-sph} in that the moments of the resulting density distribution are consistent with those extracted from the encounter data (i.e., $\chi^2_r$ is low). Again, the finite element model does not isolate the lump, instead spreading the excess mass over the right side of the asteroid. The ability of the lumpy model to isolate the core is rooted in the fact that the shape of the asteroid is offset from the center of mass by a fixed amount with no uncertainty attached. The position of the lump is therefore set to balance the offset of the surrounding asteroid medium; the only free parameter is the lump's mass, which determines this offset. The assumption that the asteroid's center of mass is precisely known is rooted stems from the fact that the shape of the asteroid is observed to rotate around its center of mass. If observations do not allow the center of mass to be determined in this way, then the lump's position will be more uncertain.

To assess the lumpy model when the positions of the lump are not as certain as in this off-center case, we consider an asteroid with two lumps of radius 300 m and density three times the surrounding density. Each lump is located 500 meters from the center of the asteroid, so that they counterbalance and the asteroid's observed center of mass is its surface's centroid. The lumpy model with $N=2$ lumps then inherits three additional DOF corresponding to one lump's position (the other lump is fixed to counterbalance it) as well as two more from the additional lump's radius and mass. The model thus has seven DOF, in contrast to the 5 DOF of the finite element model. Both models are run on this asteroid and the resulting distributions are shown in figure \ref{fig:den-double}.

\begin{figure*}
  \includegraphics[width=0.24\linewidth]{figs/double-fe-d}\hfill
  \includegraphics[width=0.24\linewidth]{figs/double-fe-s}\hfill
  \includegraphics[width=0.24\linewidth]{figs/double-fe-u}\hfill
  \includegraphics[width=0.24\linewidth]{figs/double-fe-r}

  \includegraphics[width=0.24\linewidth]{figs/double-l-d}\hfill
  \includegraphics[width=0.24\linewidth]{figs/double-l-s}\hfill
  \includegraphics[width=0.24\linewidth]{figs/double-l-u}\hfill
  \includegraphics[width=0.24\linewidth]{figs/double-l-r}

  \caption{Cross-sectional slices of the density distributions extracted via the finite-element (\textit{top}) and the two-lump lumpy (\textit{bottom}) models for an asteroid with two counterbalancing cores. From left to right, the densities, deviations from the true density, uncertainties, and significance of the deviations are plotted. These figures are available in animated form in appendix figure \ref{fig:animated-double}. The additional lump greatly increases uncertainty, but the resulting distribution is close to accurate.}
  \label{fig:den-double}
\end{figure*}

Figure \ref{fig:den-double} again shows that the finite element model is unable to isolate the lumps except to predict generally increased asteroid near the center. On the other hand, the lumpy model detects that the two lumps are opposite each other, and of roughly the same radius and mass. These radius and mass values are also close to the true values. The model places the lumps correctly in the $xy$-plane of the asteroid but does not perfectly align them with the $y$ axis, resulting in very high $\Delta \rho$ where the true lumps and predicted lumps do not intersect. Note that $\chi^2_r$ remains low despite the lumpy model's misplacement of the lumps. This is because the lumpy model gains its information on the placement of the lumps from the $K_{3m}$ density moments, which figures \ref{fig:scan-physical} and \ref{fig:scan-observational} suggest are not as well constrained as the $K_{2m}$ density moments. The moments estimated by the MCMC fit to encounter data are not perfectly correct, resulting in a deviation of a few hundred meters in lump location. Overall, the figures show that even the poorly constrained $K_{3m}$ moments can be used to determine features of the asteroid density, given a well-chosen model.


\section{Conclusions}

We derived a novel, arbitrary-order equation for the tidal torque experienced by an asteroid during an encounter with a planet of arbitrary shape and mass distribution. The tidal torque (equation \ref{eqn:tidal-torque}) revealed that the angular velocity of the asteroid over time depends strongly on the asteroid's density moments and the initial orientation. We then built a fast simulation for an asteroid encounter and designed an MCMC to extract density moments from simulated data. We also created two models --- the finite element model and the lumpy model --- to translate these density moments back into density distributions. Since this problem is underdetermined, the models give different results and were contrasted. Nevertheless, we find that the models always produce results consistent with the data set. The entire pipeline was run starting from simulated encounter data and ending with density distribution predictions and was shown to be robust.

We assessed the uncertainty of the pipeline's results by adjusting various properties of the asteroid and its Earth encounter. The precise thresholds we measure (table \ref{tab:threshold-summary}) show that the observational uncertainty and perigee of the asteroid orbit have the strongest effect on the density distribution uncertainty and they are the most important thresholds to meet in order to extract a precise distribution. We also discussed how these thresholds could be eased by changes in observational behaviour such as lengthening the data set, or by physical asteroid properties such as a closer encounter or an initially tumbling state. If the thresholds were eased enough, then the asteroid length would become an important threshold as well.

Finally, we highlighted that the properties of the final density distribution are strongly dependent. The uncertainties on density distribution of the two models were drastically different, and also depended on the number of degrees of freedom used in the model. For asteroids of non-uniform distributions, the distributions themselves also differed. The lumpy model, designed to look for specific types of features, was much more sensitive to these features than the generic finite element model. To efficiently use encounter data, it is therefore important to investigate multiple models and choose different models to answer different questions.

\section*{Acknowledgements}

We warmly thank Emmanuel Jehin, Maxime Devogele, and Marin Ferrais for meeting with the authors to discuss this work and pointing out possible future initiatives. JTD also thanks the MIT UROP office for funding his work. This paper made substantial use of MIT Supercloud's facilities.



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section*{Data Availability}

The asteroid simulation, fit process, and density moment extraction code are available on \href{https://github.com/jack-dinsmore/asteroid-tidal-torque}{GitHub}. Please contact JTD with questions.



%%%%%%%%%%%%%%%%%%%% REFERENCES %%%%%%%%%%%%%%%%%%

\bibliographystyle{mnras}
\bibliography{asteroids.bib}


\input{appendices}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\bsp	% typesetting comment
\label{lastpage}
\end{document}