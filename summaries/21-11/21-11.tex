\documentclass[linenumbers]{aastex631}

% Documentation: https://www.overleaf.com/project/61d88bb8ee06e1e18cf4ea76

\usepackage{tikz}
\usepackage{dsfont}

\newcommand{\unit}[1]{\hat{\mathbf{#1}}}
\newcommand{\parens}[1]{\left( #1 \right)}
\newcommand{\brackets}[1]{\left[ #1 \right]}
\newcommand{\jtd}[1]{{\color{red}\textit{#1}}}
\newcommand{\quat}[1]{\widetilde{\bm{#1}}}
\newcommand{\siunit}[1]{\ \textrm{#1}}
\newcommand{\per}[1]{\ \textrm{#1}^{-1}}
\usetikzlibrary{arrows.meta}

\shorttitle{Asteroid project summary}
\shortauthors{Dinsmore and de Wit}

\graphicspath{figs/}

\begin{document}

\title{Asteroid project summary}


\author[0000-0002-6401-778X]{Jack T. Dinsmore}
\affiliation{Massachusetts Institute of Technology \\
Cambridge, MA 02139}
\email{jtdinsmo@mit.edu}

\author{Julien de Wit}
\affiliation{Massachusetts Institute of Technology \\
Cambridge, MA 02139}

\begin{abstract}

Abstract. 
\end{abstract}

\keywords{Keywords, em-dash separated}



\section{Introduction}


\section{Asteroid Model}
In an effort to make a general asteroid model, we will consider the entire effect of the tidal torque applied to an asteroid from a planet, rather than solving for the first order perturbation. To better understand the effect, we will not model perturbing effects from other bodies such as the Sun or other planets. However, nearby bodies, such as moons or rings, are considered in a later section. We will also model the asteroid as a rigid body, whose density distribution is fixed throughout the flyby.

Most asteroids are observed to have attained their minimum energy rotation state, so we will also assume that the asteroid's initial state aligns its rotational velocity parallel to the principal axis with maximal moment of inertia.

\subsection{Coordinates}
\label{sec:coordinates}
We will make use of two frames of reference to model this system. One is the ``inertial frame,'' with axes denoted by $\unit{X}$, $\unit{Y}$, $\unit{Z}$. As the name suggests, these axes are inertial, with $\unit{X}$ pointing to the asteroid pericenter and $\unit{Z}$ pointing parallel to the orbit angular momentum. The origin of this frame is set to the center of mass of the central body. We will assume that the mass distribution of the central body is known in this inertial frame.

Our second frame is the ``body-fixed'' frame, denoted by $\unit{x}, \unit{y}, \unit{z}$. This frame is fixed with respect to the body's principle axes and rotates with the body, with its origin at the body's center of mass. We will solve for the asteroid's mass distribution with reference to the body-fixed frame. For definiteness, we define $\unit{z}$ to be the principal axis with maximal MOI, and $\unit{x}$ to have minimal MOI.

We define a rotation matrix $M$ such that $M\bm{r} = \bm{R}$, where $\bm{r}$ is in the body-fixed frame and $\bm{R}$ is in the inertial frame. It will be useful for us to represent this matrix in two different ways; one is with a normalized quaternion $\quat q$, and the other is with $z-y-z$ Euler angles named $\alpha$, $\beta$, and $\gamma$. In particular, we define
\begin{equation}
M = R_z(\alpha) R_y(\beta) R_z(\gamma)
\label{eqn:euler-angles}
\end{equation}
where $R_i(\theta)$ is a rotation around the $i$th unit vector by $\theta$ (figure \ref{fig:euler-angles}).


\begin{figure}
    \centering
    \begin{tikzpicture}
    \draw[-{Latex[length=3mm]}] (0, 0) -- (-4, 0) node[anchor=east] {$\unit x$};
    \draw[-{Latex[length=3mm]}] (0, 0) -- (2, -3) node[anchor=west] {$\unit y$};
    \draw[-{Latex[length=3mm]}] (0, 0) -- (0, 4) node[anchor=south] {$\unit z$};
    \draw[dashed, -{Latex[length=3mm]}] (0, 0) -- (3.7, -2) node[anchor=north] {$\unit n$};
    \draw[thick,-{Latex[length=3mm]}] (0, 0) -- (-0.5, -3) node[anchor=north] {$\unit X$};
    \draw[thick,-{Latex[length=3mm]}] (0, 0) -- (4, 0.5) node[anchor=south] {$\unit Y$};
    \draw[thick,-{Latex[length=3mm]}] (0, 0) -- (-2, 3) node[anchor=south] {$\unit Z$};
    \draw (0.5, -0.75) arc (290:302:2.5);
    \draw (0.9, -0.9) node[anchor=center] {$\alpha$};
    \draw (0, 1) arc (90:123.7:1);
    \draw (-0.4, 1.2) node[anchor=center] {$\beta$};
    \draw (0.97, -0.52) arc (330:360:1.3);
    \draw (1.4, -0.25) node[anchor=center] {$\gamma$};
    %\draw[-{Latex[length=3mm]}] (0, 0) -- (0, 4) node[anchor=south] {$\unit Z$};
    %\draw[-{Latex[length=3mm]}] (0, 0) -- (4, 0) node[anchor=west] {$\unit Y$};
    %\draw[-{Latex[length=3mm]}] (0, 0) -- (-2, -2) node[anchor=east] {$\unit X$};
    \end{tikzpicture}
    \caption{$z-y-z$ Euler angles used in this work to express the orientation of the asteroid. Orientation is expressed as a rotation from the body-fixed axes to the inertial axes.}
    \label{fig:euler-angles}
\end{figure}

We use the quaternion $\quat q$ as our dynamical variable because Euler angles suffer from gimbal lock. For the sake of this paper, we write quaternions as $\quat q = r + i \bm i + j \bm j + k \bm k$, with the complex conjugate written as $\quat q^* = r - i \bm i - j \bm j - k \bm k$. The inverse is then $\quat q^{-1} = \quat q^* / (\quat q \quat q^*)$, and we define real and imaginary parts as $\Re \quat q = r$; $\Im \quat q = i \unit x + j \unit y + k \unit z$. See a description of quaternions in Ref.~\cite{2008arXiv0811.2889G}

Normalized quaternions express rotations of an angle $\theta$ by $\quat q = \cos\frac{\theta}{2} + \sin\frac{\theta}{2}\quat n$ where $\quat n = 0 + n_x \bm i + n_y \bm j + n_z\bm k$. This rotation may be applied to any vector $\bm r$ by
\begin{equation}
\bm R = \Im \brackets{\quat q^{-1} \quat r\quat q }.
\label{eqn:quat-rot}
\end{equation}
Due to the real part of $\quat q$ which does not vanish for $\theta \rightarrow 0$, quaternions do not suffer from gimbal lock. Using the above notation, we can give the full equation of quaternion multiplication:
\begin{equation}
(q_0 + \quat q) (p_0 + \quat p) = q_0 p_0 - \bm p \cdot \bm q + p_0 \bm q + q_0 \bm p + \bm q \times \bm p.
\label{eqn:quat-mult}
\end{equation}
Note that quaternion multiplication is not commutative.


We convert from Euler angles to quaternions by writing equation \ref{eqn:euler-angles} in terms of quaternions:
\begin{equation}
\quat q = \parens{\begin{array}{c} \cos \frac{\alpha}{2} \\ 0\\ 0 \\\sin \frac{\alpha}{2}\end{array}}
\parens{\begin{array}{c} \cos \frac{\beta}{2} \\ 0 \\\sin \frac{\beta}{2}\\ 0\end{array}}
\parens{\begin{array}{c} \cos \frac{\gamma}{2} \\ 0\\ 0 \\\sin \frac{\gamma}{2}\end{array}} = \parens{\begin{array}{c}
\frac{\alpha}{2} \cos \frac{\beta}{2} \cos  \cos \frac{\gamma}{2} - \frac{\alpha}{2} \cos \frac{\beta}{2}\sin \sin \frac{\gamma}{2}\\
\frac{\alpha}{2} \sin \frac{\beta}{2} \cos  \sin \frac{\gamma}{2} - \frac{\alpha}{2} \sin \frac{\beta}{2}\sin \cos \frac{\gamma}{2}\\
\frac{\alpha}{2} \sin \frac{\beta}{2} \cos  \cos \frac{\gamma}{2} + \frac{\alpha}{2} \sin \frac{\beta}{2}\sin \sin \frac{\gamma}{2}\\
\frac{\alpha}{2} \cos \frac{\beta}{2} \cos  \sin \frac{\gamma}{2} + \frac{\alpha}{2} \cos \frac{\beta}{2}\sin \cos \frac{\gamma}{2}\\
\end{array}}.
\label{eqn:euler-to-quat}
\end{equation}
This equation can be reversed for $\alpha$, $\beta$, $\gamma$ as follows:
\begin{equation}
\tan \alpha = \frac{jk - ir}{jr + ik}\qquad \cos \beta = 1 - 2(i^2 + j^2) \qquad \tan \gamma = \frac{jk + ir}{jr - ik} .
\label{eqn:quat-to-euler}
\end{equation}



\subsection{Tidal Torque}
We start by expressing the gravitational potential energy field of the central body in its most general form:
\begin{equation}
V(\bm R') = -G\int_\mathcal{P} d^3 R \rho_M(\bm R) \frac{1}{|\bm{R}-\bm{R'}|}.
\label{eqn:first-pe}
\end{equation}
This integral is computed in the inertial frame and has units of energy per unit mass. We represent the central body density as $\rho_M$ and its volume as $\mathcal{P}$. To reduce equation \ref{eqn:first-pe}, we define the unnormalized spherical harmonics $Y_{\ell m}(\theta, \phi) = P_{\ell m}(\cos \theta)e^{im\phi}$, where $P_{\ell m}$ are the associated Legendre Polynomials without the Condon-Shortley phase. The regular and irregular spherical harmonics are then defined as
\begin{equation}
S_{\ell m}(\bm r) = (-1)^m (\ell - m)! \frac{Y_{\ell m}(\unit r)}{r^{\ell+1}} \qquad R_{\ell m} (\bm r) = (-1)^m \frac{r^\ell}{(\ell + m)!} Y_{\ell m}(\unit r).
\end{equation}

Assume that we can construct a sphere, centered at the center of mass of the central body, so that $\rho_M = 0$ outside the sphere and $\rho_m = 0$ inside the sphere. Then $R' > R$ in equation \ref{eqn:first-pe}, and Ref.~\cite{Gelderen1998TheSO} gives the identity
\begin{equation}
\frac{1}{|\bm R - \bm R'|} = \sum_{\ell, m} R_{\ell m}(\bm R) S_{\ell m}^*(\bm R'),
\label{eqn:1-over-r-expansion}
\end{equation}
where the sum is shorthand for $\sum_{\ell, m} = \sum_{\ell = 0}^\infty \sum_{m=-\ell}^\ell$.

Suppose the vector $\bm{D}$ points from the center of mass of the central body to the center of mass of the asteroid, again in the inertial frame. Then we may write $ \bm R' = \bm D + \bm U$, and Ref.~\cite{Gelderen1998TheSO} gives
\begin{equation}
S_{\ell m}(\bm R') = \sum_{\ell', m'} (-1)^{\ell'}R^*_{\ell' m'}(\bm U)S_{\ell+\ell', m + m'} (\bm D).
\end{equation}

Define the complex, unitless constants
\begin{equation}
J_{\ell m} = \int_\mathcal{P} d^3 R \rho_M(\bm R) \frac{R_{\ell m}(\bm R)}{\mu_M a_M^\ell}
\qquad
K_{\ell m} = \int_\mathcal{A} d^3 r \rho_m(\bm r) \frac{R_{\ell m}(\bm r)}{\mu_m a_m^\ell}
\label{eqn:jlm}
\end{equation}
where the integrals are taken in the inertial and the body-fixed frames respectively. Here, $\rho_m$ denotes the density of the asteroid and $\mathcal{A}$ denotes its volume. The symmetry relations of $R_{\ell m}$ guarantee $J_{\ell m} = (-1)^m J_{\ell, -m}^*$ and similarly for $K_{\ell m}$. We have chosen $\mu_M$, $\mu_m$ to be the masses of the central body and asteroid respectively, and $a_M$ and $a_m$ to be scale lengths of both bodies (defined more precisely later). Then we can express the potential as
\begin{equation}
V(\bm U) = -G \brackets{\sum_{\ell, m} \mu_M a_M^\ell J_{\ell m} \sum_{\ell', m'} (-1)^{\ell'}R_{\ell' m'}(\bm U)S^*_{\ell+\ell', m + m'} (\bm D)}.
\label{eqn:pe-unrotated}
\end{equation}
To make use of $K_{\ell m}$ in equation \ref{eqn:jlm}, we need to rotate $\bm U$ from the inertial frame into $\bm u$ in the body fixed frame via $\bm U = M \bm u$. The rotation of a spherical harmonic satisfies
\begin{equation}
Y_{\ell m}(M\bm u) = \sum_{m'=-\ell}^\ell (-1)^{m+m'}\sqrt{\frac{(\ell-m')!(\ell+m)!}{(\ell+m')!(\ell-m)!}} \mathcal{D}^\ell_{mm'}(M)^* Y_{\ell m'}(\bm u).
\end{equation}
where $\mathcal{D}$ are the Wigner-$D$ matrices. The corollary of this formula for the regular solid spherical harmonic is
\begin{equation}
R_{\ell m} (M \bm u) = \sum_{m'=-\ell}^\ell \sqrt{\frac{(\ell-m')!(\ell+m')!}{(\ell-m)!(\ell+m)!}} \mathcal{D}^\ell_{mm'}(M)^* R_{\ell m'} (\bm u)
\label{eqn:rlm-rotations}
\end{equation}
where $\mathcal{D}^\ell_{mm'}$ are the Wigner-D matrix elements. In practice, these are computed from the Euler angles corresponding to the rotation $M$, which we specified in section \ref{sec:coordinates} are $z-y-z$ Euler angles. With this choice of Euler angles, the Wigner-D matrix elements are real with matrix elements given by
\begin{eqnarray}
d^\ell_{mm'}(\beta) = &\sqrt{(\ell+m)!(\ell-m)!(\ell+m')!(\ell-m')!}\\
& \sum_{s=s_\textrm{min}}^{s_\textrm{max}} \brackets{\frac{(-1)^{m-m'+s}\parens{\cos\frac{\beta}{2}}^{2\ell + m' - m - 2s}\parens{\sin \frac{\beta}{2}}^{m-m'+2s}}{(\ell+m'-s)!(\ell-m-s)!(m-m'+s)!s!}}
\label{eqn:wigner-d-elements}
\end{eqnarray}
where $s_\textrm{min} = \max(0, m'-m)$ and $s_\textrm{max} = \min(\ell+m', \ell-m)$,
and $\mathcal{D}^\ell_{mm'}(\alpha, \beta, \gamma) = d^j_{mm'}e^{-im\alpha} e^{-im'\gamma}$.

Combining equations \ref{eqn:rlm-rotations} and \ref{eqn:pe-unrotated},
\begin{equation}
V(\bm u) = -G \brackets{\sum_{\ell, m} \mu_M a_M^\ell J_{\ell m} \sum_{\ell', m'} (-1)^{\ell'}S^*_{\ell+\ell', m + m'} (\bm D)\sum_{m''=-\ell'}^{\ell'} \sqrt{\frac{(\ell'-m'')!(\ell'+m'')!}{(\ell'-m')!(\ell'+m')!}} \mathcal{D}^{\ell'}_{m'm''}(M)^* R_{\ell' m''} (\bm u)}.
\end{equation}

The tidal torque applied to an asteroid at a point $\bm u$ is given by $d\bm \tau(\bm u) = -\rho_m(\bm u) d^3u (\bm u \times (\nabla V_{\bm u}(\bm u)))$ in the body-fixed frame, which leaves
\begin{eqnarray}
\bm\tau = &G\int_\mathcal{A}d^3u \rho_m(\bm u)  \bm u \times \nabla \left[\sum_{\ell, m} \mu_M a_M^\ell J_{\ell m} \sum_{\ell', m'} (-1)^{\ell'}S^*_{\ell+\ell', m + m'} (\bm D)
\right.\\
& \left. \sum_{m''=-\ell'}^{\ell'} \sqrt{\frac{(\ell'-m'')!(\ell'+m'')!}{(\ell'-m')!(\ell'-m')!}} \mathcal{D}^{\ell'}_{m'm''}(M)^* R_{\ell' m''} (\bm u)\right].
\label{eqn:first-tidal-torque}
\end{eqnarray}
Using the identity
\begin{eqnarray}
\bm u \times \nabla R_{\ell m}(\bm u)=&\frac{1}{2}[(i\unit x - \unit y)(\ell-m+1)R_{\ell,m-1}(\bm u)\\
&+(i\unit x+\unit y)(\ell+m+1)R_{\ell,m+1}(\bm u)+2im\unit z R_{\ell m}(\bm u)],
\end{eqnarray}
which was derived from Ref.~\cite{Gelderen1998TheSO}'s analysis of the angular momentum operators applied to spherical harmonics, we write equation \ref{eqn:first-tidal-torque} as
\begin{eqnarray}
\bm \tau = &G\frac{\mu_m\mu_M}{2}\left[\sum_{\ell, m} a_M^\ell J_{\ell m} \sum_{\ell', m'}a_m^{\ell'}S^*_{\ell+\ell', m + m'} (\bm D) (-1)^{\ell'}\sum_{m''=-\ell'}^{\ell'} \sqrt{\frac{(\ell'-m'')!(\ell'+m'')!}{(\ell'-m')!(\ell'+m')!}}  \mathcal{D}^{\ell'}_{m'm''}(M)^* \right. \\
&\bigg[(i\unit x - \unit y)(\ell'-m''+1)K_{\ell',m''-1} +(i\unit x+\unit y)(\ell'+m''+1)K_{\ell',m''+1}+2im''\unit z K_{\ell'm''}\bigg] \Bigg].
\label{eqn:tidal-torque}
\end{eqnarray}
This equation contains complex values, but it was numerically confirmed that $\bm \tau$ is a real-valued vector.

Note that each sum in this equation is weighted by a factor of $a_M^\ell a_m^{\ell'}/D^{\ell+\ell'+1}$. Since $D \gg a_M \gg a_m$ in general, the leading order torques come from low $\ell$ and $\ell'$. However, $\ell'=0$ contributes nothing because the inner bracketed term is zero, and $K_{\ell' = 1} = 0$ if we choose the origin of the body-fixed axes to be the center of mass of the asteroid. The leading order of equation \ref{eqn:tidal-torque} is therefore $1/D^3$ with $\ell = 0$ and $\ell' = 2$.


\subsection{Moment of Inertia}
The inertia tensor of the asteroid is expressed as a matrix $I$. Written in terms of spherical harmonics in the body-fixed frame, we have
\begin{eqnarray}
I = &\int_\mathcal{A} d^3 r\rho_m(\bm r) \parens{\begin{array}{ccc}
y^2 + z^2 & -xy & -xz \\
-xy & x^2 + z^2 & -xz \\
-xz & -yz & x^2 + y^2 \\
\end{array}}\\
= &\frac{2}{3}\mu_m a_m^2\parens{\begin{array}{ccc}
K_{20}-3K_{2,-2}-3K_{22}+1 & 3i \parens{K_{22}-K_{2,-2}} & \frac{3}{2}\parens{K_{21}-K_{2,-1}}\\
3i \parens{K_{22}-K_{2,-2}} & K_{20}+3K_{2,-2}+3K_{22}+1 & -\frac{3}{2}i\parens{K_{21}+K_{2,-1}}\\
\frac{3}{2}\parens{K_{21}-K_{2,-1}} & -\frac{3}{2}i\parens{K_{21}+K_{2,-1}} & -2K_{20}+1\\
\end{array}}
\label{eqn:moi}
\end{eqnarray}
where we have defined, for neatness,
\begin{eqnarray}
a_m^2=\frac{1}{\mu_m}\int_\mathcal{A} d^3 r \rho_m(\bm r) r^2.
\label{eqn:am}
\end{eqnarray}
With this definition of $a_m$, and an arbitrary definition of $a_M$ which may be taken to be similar to equation \ref{eqn:am} or a more convenient unit such as the central body radius, the parameters $J_{\ell m}$ and $K_{\ell m}$ of equation \ref{eqn:jlm} are completely defined. Note that $a_m$ is similar to the radius of the asteroid; if the asteroid is a sphere of uniform density and radius $r$, then $a_m = r\sqrt{3/5}$.

Henceforth, we define the body-fixed axis to be coincident with the principal axes of the asteroids, so that the off-diagonal components of $I$ are zero.

\subsection{Equation of Motion}
As a simplifying assumption, we will not model the effect of the central body's non-sphericity on the asteroid orbit. This effect has been studied in much detail and is small. We therefore separate the position dynamical variables from the angular variables and derive the standard equations of motion for asteroid position in the inertial frame:
\begin{equation}
\dot{\bm{V}} = -\frac{G\mu_M}{r^3}\bm{D}\qquad \dot{\bm{D}} = \bm{V}.
\label{eqn:translaton-eom}
\end{equation}
The position variables will no longer be discussed.

Let $\bm\omega$ be the rotational velocity of the asteroid in the body-fixed frame. We have two equations of motion for our system; one governs the evolution of $\bm \omega$ and the other governs the evolution of $\bm q$. Starting with the latter, consider a fixed point $\bm r$ in the body-fixed frame on a rotating asteroid. The corresponding point $\bm R$ in the inertial frame satisfies $\dot{\bm R} = \Im[\quat q^{-1}(\bm \omega \times \bm r )\quat q]$. Furthermore, we can demand that $\bm \omega \perp \bm r$ such that $\bm \omega \times \bm r = \Im[\quat \omega \quat r]$ Plugging this into equation \ref{eqn:quat-rot}, we have
\begin{equation}
\dot{\quat q^{-1}} \quat r \quat q + \quat q^{-1} \quat r \dot{\quat q} = \quat q^{-1}\quat \omega \quat r \quat q.
\nonumber
\end{equation}
Substituting $\bm r \rightarrow \bm R$ and acknowledging that $\Re[\dot{\quat q} \quat q^{-1}]$,
\begin{equation}
2\dot{\quat q^{-1}}\quat q\quat R = \quat q^{-1}\quat \omega \quat q \quat R.
\nonumber
\end{equation}
Since $\bm R$ is arbitrary, this simplifies to
\begin{equation}
\dot{\quat q} = \frac{1}{2}\quat \omega\quat q.
\label{eqn:quat-eom}
\end{equation}

The second equation of motion are Euler's equations of motion given our expression for tidal torque. Namely,
\begin{eqnarray}
I_1 \dot \omega_1 - \omega_2 \omega_3 (I_2 - I_3) &= \tau_1\\
I_2 \dot \omega_2 - \omega_3 \omega_1 (I_3 - I_1) &= \tau_2\\
I_3 \dot \omega_3 - \omega_1 \omega_2 (I_1 - I_2) &= \tau_3\\
\label{eqn:omega-eom}
\end{eqnarray}
The components of $\bm \tau$ are given by equation \ref{eqn:tidal-torque}, which was also in the body-fixed frame.


\subsection{Initial Values}
We assume that the asteroid begins the simulation in its minimum energy configuration; that is, with $\bm \omega \parallel \unit z$. The initial conditions are therefore that $\bm \omega = \omega \unit z$, and the quaternion is fixed to rotate $\hat z$ to $\bm \Omega$ in the inertial frame, which fixes Euler angles $\beta$ and $\gamma$. The third Euler angle $\alpha$ represents the initial roll of the asteroid, and therefore cannot be determined from physical data. However, it is an initial condition of the simulation. Once the Euler angles are known, the quaternion is computed via equation \ref{eqn:euler-to-quat}.


\subsection{Fit Parameters}
By requiring that the $\unit x, \unit y, \unit z$ axes coincide with principal axes, we force the diagonal components of $I$ to be zero. Thus, we may require $K_{21}=K_{2,-1}=0$ and $\Im K_{22}=\Im K_{2,-2}=0$ with no loss of generality. By requiring that the body-fixed frame be located at the center of mass of the asteroid, we also require $K_{1m}=0$. Finally, $K_{00}=1$ follows automatically from the definition. Thus, $K_{20}$, $\Re K_{22}$, and $K_{\ell>2, m}$ are the only physical parameters of the asteroid density distribution, beyond $a_m$.

As discussed before, the leading order of equation \ref{eqn:tidal-torque} is $\ell' = 2$. Therefore, the equation is proportional to $\mu_m a_m^2$. Factoring out this product results in an equation of motion independent of $\mu_m$, meaning that the asteroid dynamics are unaffected by the mass of the asteroid. This is expected, and it means that the density distribution of the asteroid can only be determined up to a scale factor.

Since the coefficient of $J_{lm}K_{l'm'}$ is proportional to $a_M^\ell a_m^{\ell'} / D^{\ell+\ell'+1}$, to first order in the asteroid density distribution, the system is also independent of $a_m$. When $K_{\ell' > 2}$ terms are included, $a_m$ scales the size of the higher order terms.

We require that the moment of inertia matrix be positive-definite, which bounds our asteroid parameters. Specifically, we have $K_{20} \leq \frac{1}{2}$, and $|K_{22}| \leq (K_{20}+1)/6$. We can also choose without loss of generality to let the maximum moment of inertia align with $\unit z$, so that $1-2K_{20}\geq K_{20}+1+6|K_{22}|.$ Finally, we wish to require that the density of the asteroid be everywhere positive. One consequence of this requirement is that the sum of any two distinct moments of inertia cannot be greater than the third, by the integral definition of moment of inertia in equation \ref{eqn:moi}. Three inequalities result from this, but only one is not covered by the above restrictions. Namely, $I_{xx} + I_{yy}\geq I_{zz} \Rightarrow K_{20} \geq -1/4$. The intersection of these requirements forces $K_{20}$ and $K_{22}$ to lie in the triangle defined by
\begin{equation}
-\frac{1}{4} \leq K_{20} \leq 0 \qquad |K_{22}| \leq -\frac{K_{20}}{2}.
\label{eqn:parameter-bounds}
\end{equation}


We have one additional fit parameter, which is the only initial condition not fixed by the problem setup or observations. Namely, the initial value of the first Euler angle $\alpha_0$. Due to the fact that the principal axes $\unit x$ and $\unit y$ are orthogonal, Increments of $\alpha_0$ by $\pi/2$ correspond to flipping the body-fixed axes so that no physical change in the asteroid model occurs. We must therefore limit the range of $\alpha_0$ to width $\pi/2$. Arbitrarily, we choose $\alpha_0 \in [-\pi/4, \pi/4)$

\section{Experiment Design}
\subsection{Simulation Design}
\label{sec:simulation}
Given the observed orbit of an asteroid and observational data of its resolved spin over time, we built a simulation that would integrate equations \ref{eqn:quat-eom} and \ref{eqn:omega-eom} to generate synthetic data. Inputs to the simulation were (1) the $\ell$ and $\ell'$ values at which to truncate the potential energy sum in equation \ref{eqn:tidal-torque}, (2) the cadence of observations, (3) the $J_{\ell m}$ parameters and mass and radius of the central body, (4) a guess at the asteroid parameters $K_{\ell m}$, $\alpha_0$ and $a_m$, (5) the initial rotational velocity of the asteroid in the inertial frame, and (6) the asteroid's orbital parameters.

The orbital parameters we use to describe the orbit are the hyperbolic excess velocity $v_\infty$ and the pericenter altitude $r_p$. The orbit orientation is fixed to lie in the $\unit X-\unit Y$ plane, with pericenter lying on $\hat X$. The position of the satellite as a function of time is therefore generated by numerically integrating the Newtonian equation of motion (equation \ref{eqn:translaton-eom}) from initial values $\bm r(t=0) = r_p \unit X$ and $\bm v(t=0)=\unit Y \sqrt{v_\infty^2 + 2G\mu_M / r_p}$

Once the inputs were specified, the moments of inertia were pre-computed from $K_{\ell m}$, as was the orbital path of the satellite as a function of time. Equations \ref{eqn:quat-eom} and \ref{eqn:omega-eom} were then integrated by the fourth order Runge-Kutta fourth order method with a time step of 100 seconds, with a custom implementation of the spherical harmonics and Wigner-D matrices to improve runtime. This time step was observed to produce equivalent spin data to data made by lower time step. At fixed time intervals, the rotational velocity in the body-fixed frame $\bm\omega_{xyz}$ was converted via equation \ref{eqn:quat-rot} to the inertial frame to produce synthetic data.

Since the leading order of the equations of motion is $\ell' = 2, \ell = 0$, we begin our simulation at $D = D f^{-1/3}$, where $f$ is a manually set parameter to control the length of the simulation. For all simulations done here, $f = 10^{-3}.$ We end the simulation also at $D f^{-1/3}$ on the other side of the orbit.

Except when otherwise mentioned, we use the following fit parameters when running the simulation.
\begin{enumerate}
\item An orbit around Earth with $4\siunit{km}\per{s}$ excess velocity and perigee at 5 Earth radii
\item An asteroid with radius $a_m = 1\siunit{km}$ and $K_{3m}=0$. For $K_{22}$ and $K_{20}$, we use two standard values. One with $(K_{22}, K_{20}) = (0.052, -0.202)$ and one with $(0, -0.097)$. Including the third point obtained by reflection $K_{22}\rightarrow -K_{22}$, these are the three points that minimize the mean distance between an arbitrary point in the allowed parameter space (equation \ref{eqn:parameter-bounds}) and the standard values
\item An initial roll of $\alpha_m=\pi/8$
\item A cadence of 2 minutes and observational uncertainty of $\sigma_\theta = 0.01$
\item A rotational period of 5 hours, with spin axis pointing 45$^\circ$ below the orbital plane
\end{enumerate}



\subsection{Fitting Method}
To analyze the degree to which asteroid density distributions can be determined from flyby rotational velocity data, we use the forward model defined in section \ref{sec:simulation} to generate synthetic data, randomize the data according to one of the observational uncertainty model defined in section \ref{sec:uncertainty-models}, then use the same forward model to fit to the data and recover parameters.

After randomizing the data, we isolate a set of parameters which are likely to provide good fits. To do this, we minimize the $\chi^2$ value of the data given the model using the BFGS algorithm. Our starting points for the minimization are spaced uniformly randomly across the allowed parameter space, which is the set of parameters with the triangle described by equation \ref{eqn:parameter-bounds}. The other parameter bounds are $\alpha_0 \in [-\pi/4, \pi/4)$, and $|\Re K_{l>2}| \leq  1$, $|\Im K_{l>2}| \leq  1$.

If the minimization is conducted over too many parameter dimensions, convergence can be slow and potentially inaugurate. However, the parameters $K_{\ell m}$ are naturally separated into groups by order of $\ell$, since the torque applied by successive increment to $\ell$ is suppressed by $a_m/D$. Thus, we fit the $\ell=2$ and $\alpha_0$ parameters first, then lock them in place and fit the $\ell=3$ parameters, etc. The result is a set of points in parameter space which minimize the $\chi^2$.

We are interested in finding not just the optimal parameters, but the probability distributions of each fit parameter. To do this, we use an Affine Invariant Markov Chain Monte Carlo Ensemble Sampler (MCMC), implemented in the Python package \texttt{emcee}, to conduct the fit to data \cite{ForemanMackey2013emceeTM}. This fit method requires the parameter space to be populated with ``walkers,'' indicating the a guess at the true parameters of the system. We center these walkers on the minimizing parameters computed by the minimization of $\chi^2$, and spread out the walkers such that the number density of walkers is proportional to the likelihood ($\ln \mathcal{L} = -\chi^2$) at each point. This is done explicitly by computing the Hessian $\Sigma$ of the likelihood at each minimizing point $\theta_0$ and expressing the likelihood locally as a multi-dimensional Gaussian
\begin{equation}
\mathcal{L}(\bm \theta) \propto \text{exp}\parens{\frac{1}{2}(\bm \theta-\bm \theta_0)^T \Sigma (\bm \theta-\bm \theta_0)}.
\end{equation}
We may change bases into a frame in which the parameters are uncorrelated by multiplying by $D^T$, which is the matrix of eigenvectors of $\Sigma$. Populating the walkers in this uncorrelated space according to Gaussian standard deviations given by the eigenvalues of $\Sigma$, we can convert these walkers back to $\bm \theta$-space by multiplying by $D$.

With the initial walkers distributed, we use the $\chi^2$ value as the log-likelihood to compute the posterior probability distribution of $\bm \theta$ given flat priors in the range outlined above for each parameter.


\subsection{Uncertainty Models}
\label{sec:uncertainty-models}
We model uncertainties in experimental data according to several methods, comparing them to determine the dependence of our conclusions on the sensitivity model used. In every case, the sensitivity model is used both to add randomness to the data set after it is generated, and to weight the $\chi^2$ statistic.

\subsubsection{Nominal Method}
The most detailed uncertainty model we use, and the one we use most often, is called the ``nominal method.'' It rotates each angular velocity vector by some angle $\Theta$ drawn from a normal distribution centered on $\Theta=0$ with standard deviation $\sigma_\theta$. The period is assumed to be known to arbitrary precision at each cadence. The direction in which the velocity is rotated is chosen from a uniformly random distribution. $\sigma_\theta$ is a general parameter which can be tweaked to model resolution of the spin axis direction.

Practically, the randomization of the data is done by creating a rotation matrix $M$ that rotates $\unit Z$ to the true rotational velocity vector $\bm \omega$. This same rotation matrix is then used to rotate the random vector $\bm \Omega = \sin \Theta \cos\Phi \unit X + \sin \Theta \sin \Phi\unit Y + \cos \Theta\unit Z$ to the randomized velocity vector. Here, $\Phi$ is a uniformly random variable in the range $[0, \pi)$. Specifically, we write this rotation matrix as
\begin{equation}
M = \parens{\begin{array}{ccc}
\cos \phi & -\sin \phi & 0\\
\sin \phi & \cos \phi & 0\\
0 & 0 & 1
\end{array}}
\parens{\begin{array}{ccc}
\cos \theta & 0 & \sin \theta \\
0 & 1 & 0\\
-\sin \theta & 0 & \cos \theta
\end{array}}
\label{eqn:rotate-uncertainty-matrix}
\end{equation}
where $\theta$ and $\phi$ are the spherical coordinates of the original velocity vector $\bm \omega.$

Equation \ref{eqn:rotate-uncertainty-matrix} is sufficient to randomize synthetic data, but an analytical expression for the coordinates of $\bm \omega$ is required to define the $\chi^2$ value used for fitting. We approximate the distribution of each spin coordinate as normal, with covariance given by the covariance of the true distribution. Based on equation \ref{eqn:rotate-uncertainty-matrix}, the covariance matrix is
\begin{equation}
\text{Cov}(\bm \omega) = \frac{1}{4}\parens{1-e^{-\sigma_\theta^2}} \parens{1-3e^{-\sigma_\theta^2}}\parens{\begin{array}{ccc}
\omega_x^2 & \omega_x \omega_y& \omega_x \omega_z\\
\omega_x \omega_y & \omega_y^2 & \omega_y \omega_z\\
\omega_x \omega_z & \omega_y \omega_z& \omega_z^2
\end{array}} +  \frac{\omega^2}{4}\parens{1 - e^{-2\sigma_\theta^2}} \mathds{1}.
\label{eqn:rotate-uncertainty-var}
\end{equation}

We then define the $\chi^2$ statistic to be
\begin{equation}
\chi^2 = \sum_{i=0} (\bm \omega_i^* - \bm \omega_i)^T\text{Cov}^{-1}(\bm\omega^*_i)(\bm \omega_i^* - \bm \omega_i)
\end{equation}
where $\bm \omega_i$ is the $i$th expected spin and $\bm \omega_i^*$ is the data. We also refer to the reduced chi squared, $\chi^2_r = \chi^2 / (3N)$, where $N$ is the number of $\bm \omega_i$ in the data set.


\subsubsection{Position dependent method}
In practice, precision on the asteroid spin axis will increase with decreasing distance \jtd{Citation needed}. The nominal sensitivity model does not account for this; however, we can approximate this effect by choosing $\sigma_\theta$ from the nominal method to be position-dependent. Specifically, we choose
\begin{equation}
\sigma_\theta(D) = unimplemented.
\label{eqn:pos-dependent-sensitivity}
\end{equation}
We do not expect this change to differ qualitatively from the nominal method because resolution is most important near pericenter, where $D$ is stationary to first order.



\subsection{System Setup}
We study several environments for our asteroid, including (1) a flyby of a single, spherical planet, (2) a close flyby of a ringed planet, (3) a flyby of a planet with a moon, and (4) a close flyby of a planet with a moon. The qualitative and quantitative differences between these flyby types are discussed below.

\subsubsection{One Spherical Planet}
The simplest setup for an asteroid flyby is a close flyby of a single, spherical body. We call this central body a ``planet'' because it is likely that a body massive enough to observably torque an asteroid would be a planet. For such a body, the only relevant physical parameter is its mass, $\mu_M$, since $J_{00} = 1$ and the other $J_{\ell m}$ parameters are zero.

\subsubsection{Ringed Planet}
Equation \ref{eqn:tidal-torque} demonstrates that parameters controlling non-sphericity in the central body ($J_{2m}$, $J_{3m}$, etc.) are damped by a factor of $(a_M/D)^\ell$, where $a_M$ can be thought to be the radius of the central body. Furthermore, the $J_{1m}$ terms are all zero by choosing the center of mass of the central body to be the origin of the coordinate system. Thus, we are interested in the extreme values of $J_{\ell \geq 2}$ and whether they have a significant effect on the observability of asteroid density distributions. An example of such an extreme value is the presence of a planetary ring.

For a ring of inner radius $a$, outer radius $b$, and mass $\mu_r$ oriented in the $\unit X-\unit Y$ plane, the only changed $J_{\ell m}$s have $m = 0$ by rotational symmetry. Furthermore, $Y_{\ell, m} = 0$ on the equator for odd $m$, and $(-1)^{\ell/2} \ell! / (2^\ell (\ell/2)!^2)$ otherwise. Thus, we have
\begin{equation}
J_{\ell m} = \begin{array}{cc}
\frac{2 \pi \sigma}{\mu_M + \pi(b^2-a^2)\sigma}\frac{(-1)^{\ell/2}}{a_M^\ell}\frac{b^{\ell+2} - a^{\ell+2}}{2^\ell (\ell/2)!^2 (\ell + 2)}
 & \text{for}\ m = 0,\ l\ \text{even},\ l \neq 0\\
1 & \ell = 1\\
0 & \text{else}
\end{array}
\label{eqn:ring-jlm}
\end{equation}
where $\mu_M$ is the mass of the planet without the ring and $\sigma_s$ is the surface density of the ring.


The oblateness $\epsilon$, also called $J_2$ of a body is defined as $\epsilon = (I_z - I_x)/(\mu_M a_M^2)$, where $I_x = I_y$ (that is, $J_{22} = 0$) and $a_M$ is the true radius of the body, not the value defined in equation \ref{eqn:am}. Expressed in terms of $J_{\ell m}$, this is $\epsilon = -2J_{20}$. We can compare typical oblateness to the $J_{20}$ value from equation \ref{eqn:ring-jlm} to see which effect is more dramatic.

Using data from the NASA Saturn Fact Sheet, we arrive at $J_{20}\sim 10^{-8}$ from rings, but $10^{-4}$ from oblateness. So oblateness is in fact the stronger effect.

\jtd{Don't actually use this section in the paper. I'm keeping it here as a math repository. Change the section to an oblate planet.}

\subsection{Planet with a Moon: Distant Flyby}
Consider a system with a moon of mass $\mu_{o}$ at constant displacement $\bm R$ from the central body. We assume that both the planet and the moon are spherical. As long as the distance from the barycenter of the planet-moon system to the asteroid $D$ always satisfies $D>r$ we are free to use the formalism developed above, absorbing the moon into $J_{\ell m}$. Making use of the identity \cite{Gelderen1998TheSO}
\begin{equation}
R_{\ell m}(\bm R + \bm R') = \sum_{\ell' = 0}^\ell \sum_{m'=-\ell'}^\ell R_{\ell' m'}(\bm R') R_{\ell-\ell', m-m'}(\bm R)
\end{equation}
\jtd{Is this true?}
for $R > R'$, we have
\begin{equation}
J_{\ell m} = \frac{1}{(\mu_M+\mu_0) a_M^\ell}\brackets{\delta_{\ell 0}\delta_{m0}\mu_M + \int_\mathcal{P} d^3 r' \rho_o(\bm r') R_{\ell m}(\bm R + \bm r')}
\end{equation}
\begin{equation}
J_{\ell m} = \frac{1}{(\mu_M+\mu_0)}\brackets{\mu_M\delta_{\ell 0}\delta_{m0} + \mu_o \frac{R_{\ell m}(\bm R)}{ a_M^\ell}}
\end{equation}
where the $\delta$s are Kroneker deltas. It is apparent that if $a_M^\ell$ remains the radius of the planet, $|J_{\ell m}| \rightarrow \infty$ as $\ell \rightarrow \infty$. However, since each $J_{\ell m}$ is damped by $a_M^\ell / D^\ell$ and since $R < D$ by construction, the series in equation \ref{eqn:tidal-torque} remains roughly geometric and does not blow up. For the sake of this calculation, we neglect motion of the moon during the flyby.

For our tests, we use parameters similar to our Moon: we set $\mu_o = 0.01 \mu_M$ and $R = 60 a_M$.


\subsection{Planet with a Moon: Close Flyby}
If, contrary to the previous section, we want to fly by both the moon and the planet of a binary system, we must consider the tidal torque contributions from both bodies separately. The formalism above cannot be extended to write one set of $J_{\ell m}$ for both the moon and planet. To do this, we generate two separate paths of $\bm D(t)$, one pointing from the central body to the asteroid and one pointing from the moon the asteroid. Both are defined in the inertial reference frames. Then the torque from both can be computed by equation \ref{eqn:tidal-torque} and added to get the net torque on the asteroid. Again, we neglect motion of the moon during the flyby.



\section{Results}
\subsection{Dependence on asteroid parameters}

\subsection{Dependence on observational precision}

\subsection{Dependence on orbital parameters}

\subsection{Dependence on spin pole}

\subsection{Dependence on cadence}

\subsection{Dependence on blocking out perigee}

\subsection{Exotic scenarios}

\subsubsection{Oblate planet}

\subsubsection{Distant moon}

\subsubsection{Close moon}




\section{Interpretation of the Fit Parameters}
The physical parameters $K_{\ell m}$ resulting from a fit to flyby data, while physical, do not completely describe an asteroid. Since the density distribution of the asteriod has many more degrees of freedom in general than the number of known $K_{\ell m}$, there are often many degenerate density distributions associated with one set of $K_{\ell m}$. As an example, consider a spherical asteroid of radius $A$ and density distribution of the form $\rho(\bm r) = \sum_{\ell m} f_{\ell m}(r) Y_{\ell m}^*(\unit r)$. Then we have
\begin{equation}
K_{\ell m} = N_{\ell m} \frac{(-1)^m}{(\ell + m)!(\mu_m a_m^\ell)}\int_0^A r^{2+\ell} dr f_{\ell m}(r)
\end{equation}
where $N_{\ell m}$ is given by equation \ref{eqn:nlm}. Thus, $K_{\ell m}$ constrains only the integrals of $f_{\ell m}$, not the functions themselves. By relaxing the assumption that the asteroid is a sphere, even more degeneracy is introduced.

To avoid this degeneracy, we either (1) assume that the density is constant and solve for the asteroid surface (section \ref{sec:constant-density}), (2) assume that the surface of the asteroid is fixed and solve for $\rho(\bm r)$. In the latter case, we can avoid the above degeneracy either by assuming $\nabla^2 \rho = 0$ (section \ref{sec:laplace-rho}) or by using a numerical approach to find a more characteristic density distribution (section \ref{sec:numerical-density}).

\jtd{Not all of these models will be in the paper. This is a list of all the models I've thought of. I'll give some examples of applying these models to ``realistic'' asteroid density profiles (uniform, regolith over rock, etc) and see what they get, using that filter to describe the best.}

\subsection{Constant Density Asteroid Model}
Suppose our asteroid has constant density $\rho_0$ and known parameters $K_{\ell m}$ and $a_m$. We do not expect to solve for $\rho_0$ or equivalently $\mu_m$ since the mass of the asteroid cannot be extracted from tidal torque. However, we can solve for the asteorid shape required to match the known $K_{\ell m}$. In this process, we ignore $a_m$ until the last step, when we rescale the asteorid shape model until the correct $a_m$ is yielded.

Suppose the asteroid is ``star shaped'' in that every point on its surface maps to a unique set of spherical coordinates $\theta, \phi$, and $r(\theta, \phi)$. We use the helpful identity
\begin{equation}
  K_{\ell m} = \frac{\rho_m}{\mu_m a_m^\ell} \int_\mathcal{A} d^3 r R_{\ell m} (\bm r)
   = \frac{\rho_m}{\mu_m a_m^\ell} \int_\mathcal{A} d^3 r \nabla \cdot \bm v (\bm r)
    = \frac{\rho_m}{\mu_m a_m^\ell} \oint_{\partial \mathcal{A}} d^2 \bm r \cdot \bm v (\bm r)
\end{equation}
where $\bm v (\bm r) = \unit r R_{\ell m} (\bm r) r / (3+\ell) $. We know the area element satisfies $d^2 \bm r = \partial \bm r / \partial \theta \times \partial \bm r / \partial \phi$ in our coordinates, and when dotted with $\bm v \propto \unit r$, this gives
\begin{equation}
  K_{\ell m} = \frac{\rho_m}{\mu_m a_m^\ell(3 + \ell)} \int_0^\pi d\theta \sin \theta\int_0^{2\pi}d\phi r(\theta, \phi)^3 R_{\ell m}(r(\theta, \phi), \theta, \phi).
  \label{eqn:constant-density-klm}
\end{equation}
The integrand of each $K_{\ell m}$ therefore is proportional to $r(\theta, \phi)^(3+\ell)$ times constants and a spherical harmonic. We can write $r(\theta \phi) = \sum_{\ell m} Y_{\ell m}^* C_{\ell m}$ without loss of generality, in which case equation \ref{eqn:constant-density-klm} becomes a polynomial of degree $3+\ell$ in terms of $C_{\ell' m'}$ and integrals of products of spherical harmonics. These integrals can be precomputed, since they are taken over the whole sphere $\theta \in (0, \pi)$ and $\phi \in (0, 2\pi)$. Equation \ref{eqn:constant-density-klm} can then be numerically solved to get $C_{\ell m}$. Specifically, the ratios of $K_{\ell m} / K_{\ell 0}$ can be solved for to eliminate the prefactor, then $\rho_m / \mu_m$ chosen such that $K_{00} = 1$. If $n$ values of $K_{\ell m}$ are known, then this method solves exactly for $n$ values of $C_{\ell m}$.
\jtd{Implement this as a check.}


\subsubsection{Special Case: Constant Density Ellipsoid}
\label{sec:constant-density-ellipsoid}
Suppose that only $K_{\ell = 2}$ are known. Then the above method is not necessary to compute the uniform density shape; we can assume the asteroid is an ellipsoid and solve for the axis lengths, which are
\begin{equation}
a = \sqrt{\frac{5}{3}}a_m\sqrt{1-2K_{20}+12K_{22}} \qquad b = \sqrt{\frac{5}{3}}a_m\sqrt{1-2K_{20}-12K_{22}} \qquad c = \sqrt{\frac{5}{3}}a_m\sqrt{1+4K_{20}}.
\label{eqn:ellipsoid-klm}
\end{equation}
These arise out of computing the moments of inertia for a constant density ellipsoid and using equation \ref{eqn:moi} to relate the result to $K_{\ell m}$ and $a_m$. The values $a$, $b$, and $c$, represent semi-axes aligned with $\unit x$, $\unit y$, and $\unit z$ respectively.

Again, the density of this asteroid cannot be extracted because, as is a general principle of gravitational interactions, the mass of the asteroid does not affect its dynamics.

\subsection{Fixed Surface $\nabla^2 \rho = 0$ model}
Now suppose the shape of the asteroid is known, perhaps by a simplifying guess or perhaps by direct observation during a flyby. Then a density distribution $\rho(\bm r)$ can be solved for which is consistent with observed values of $K_{\ell m}$. Supposing $\nabla^2 \rho = 0$ and removing terms which are undefined at $r=0$, we write $\rho(\bm r) = \sum_{\ell m} C_{\ell m} R_{\ell m}^* a_m^\ell \mu_m$. Thus, $K_{\ell m} = \sum_{\ell' m'} C_{\ell' m'} B_{\ell \ell' m m'}$ where
\begin{equation}
  B_{\ell \ell' m m'} = \int_{\mathcal{A}}d^3 r R_{\ell m}(\bm r) R_{\ell' m')}(\bm r)
  \label{eqn:blm}
\end{equation}
can be precomputeded due to the shape of $\mathcal{A}$ being known.
If we write $K_{\ell m}$ as a vector $\bm K$ and similarly for $\bm C$, we can write $B_{\ell \ell' m m'}$ as a matrix $\hat B$, obtaining $\bm K = \hat B \bm C$. It follows that the density distribution coefficients are given by
\begin{equation}
\bm C = \hat B^{-1} \bm K.
\end{equation}
The scale parameter $a_m$ can be computed from the resulting values of $\bm C$ and the distance scale can be adjusted until $a_m$ matches the true value. As before, $\mu_m$ is a free parameter representing the impossibility of fitting for the mass of the asteroid. Since only a finite number of $K_{\ell m}$ are known, we can only solve for a finite number of $C_{\ell m}$ and neglect the higher order terms.

Physically, there is no reason to expect $\nabla^2 \rho = 0$. However, the space of density distributions with $\nabla^2 \rho = 0$ is a useful proxy for the true density distribution, since this section demonstrates how the denisty distribution can be solved for within this subspace. Conceptually, the density distribution derived from the $C_{\ell m}$s can be viewed as a projection from the true density distribution into the closest density distribution with $\nabla^2 \rho = 0$ everywhere.

Note that if $\mathcal{A}$ is assumed to be a sphere, $B_{\ell \ell' m m'} \propto \delta_{\ell \ell'} \delta_{m m'}$ and $B_{\ell \ell m m}$ can be computed analytically. Thus, the matrix inversion step is not required in this case.

\subsection{Fixed Surface Numerical Model}
Now we approach the problem of solving for the density distribution of an asteroid from the $K_{\ell m}$ parameters with more general assumptions. Suppose the shape of the asteroid is known, where ``known'' in this case means that an indicator function $\mathds{1}(\bm r)$ exists such that $\mathds{1}(\bm r) = 1$  inside the asteroid and 0 elsewhere. Then we suggest a numerical algorithm to compute a representative distribution of the asteroid density distribution. Given $n$ known values of $K_{\ell m}$, the algorithm proceeds as follows.
\begin{enumerate}
\item Fill the asteroids with $n$ uniformly random ``seed points'' by distributing them inside a bounding box containing the asteroid and rejecting those with positions $\bm r_i$ such that $\mathds{1}(\bm r_i) = 0.$
\item Construct $n$ regions $\mathcal{R}_i$around each point such that the $i$th region is the set of all points inside the asteroid closest to the $i$th point. Suppose $R_i$ has uniform density $\rho_i$.
\item For each region, compute $\overline K_{\ell m}^i = \frac{1}{\mu_m a_m^\ell}\int_{\mathcal{R}_i} d^3 r R_{\ell m}(\bm r)$. Once again, $\mu_m$ is a free parameter and units can be chosen such that $a_m=1$. Then %we can write $K_{\ell m} = \sum_i \rho_i \overline K_{\ell m}^i$.
\item Write $\overline K_{\ell m}^i$ as a square matrix $\hat{\overline K}$ with columns indexed by $i$ and rows indexed by $\ell$ and $m$. Invert it to get $\bm \rho = \hat {\overline K}^{-1} \bm K$.
\item Go back to step 1 and compute new density maps with new draws of seed points. Since $K_{\ell m}$ is linear in $\rho$, the average density distribution also satisfies the fitted $K_{\ell m}$. Use the average as the asteroid density distribution.
\end{enumerate}

\jtd{What does this give mathematically?}



\section{Uncertainty Testing}


\section{Conclusion}


\jtd{Talk about the walker spacing: the clamps, the scale with sigma, and the block diagonal hermitian matrices}

\jtd{Talk about the breaking up of the likelihood function during minimization}

\jtd{Talk about first order torque}

\jtd{Talk about how numerical accuracy was chosen}

\jtd{Show plot of likelihood}

\jtd{Show plot of simulation}

\jtd{Move up error bar section so that plots can be explained}

\jtd{Show corner plot}

\jtd{Talk about how the representative points were chosen.}


\vspace{5mm}
\facilities{MIT Supercloud}

%% Similar to \facility{}, there is the optional \software command to allow 
%% authors a place to specify which programs were used during the creation of 
%% the manuscript. Authors should list each code and include either a
%% citation or url to the code inside ()s when available.

\software{emcee, scipy.optimize.minimize, numdifftools.Hessian}

\appendix

\section{Representative flyby configurations}


\section{Initial MCMC walker positions}



\bibliography{asteroids}{}
\bibliographystyle{aasjournal}



\end{document}
